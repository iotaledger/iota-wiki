<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="IOTA Wiki Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="IOTA Wiki Blog Atom Feed">
<link rel="preconnect" href="${matomoUrl}">
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://matomo.antonionardella.it/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","6"]);var e=document,t=e.createElement("script"),p=e.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=a+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>
<link rel="search" type="application/opensearchdescription+xml" title="IOTA Wiki" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">6.2 Opinion Setting | IOTA Wiki</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wiki.iota.org/IOTA-2.0-Research-Specifications/6.2 Opinion Setting"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-IOTA-Research-Specifications-current"><meta data-react-helmet="true" property="og:title" content="6.2 Opinion Setting | IOTA Wiki"><meta data-react-helmet="true" name="description" content="6.2.1 Preliminaries"><meta data-react-helmet="true" property="og:description" content="6.2.1 Preliminaries"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/6.2 Opinion Setting"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/6.2 Opinion Setting" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/6.2 Opinion Setting" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.631015e4.css">
<link rel="preload" href="/assets/js/runtime~main.37078fcd.js" as="script">
<link rel="preload" href="/assets/js/main.6bcab317.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#ff0000;color:#fff" role="banner"><div class="announcementBarContent_3EUC">The work on this Wiki is still in progress. Consider contributing by using the in page editor or creating a <a href="https://github.com/iota-community/iota-wiki">PR directly</a></div></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/learn/about-iota/an-introduction-to-iota"><div class="link"><div class="link__body"><div class="link__label">Learn</div></div></div></a><a class="navbar__item navbar__link" href="/docs/participate/support-the-network/about-nodes"><div class="link"><div class="link__body"><div class="link__label">Participate</div></div></div></a><div class="dropdown dropdown--hoverable"><a href="#" class="navbar__item navbar__link"><div class="link"><div class="link__body"><div class="link__label">Build</div></div></div></a></div><div class="dropdown__container"><div class="dropdown__menu dropdown__menu--mega"><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Getting Started</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Chrysalis (IOTA 1.5)</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Libraries</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Smart Contracts</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/docs/build/getting-started/architecture"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Getting Started</div><div class="link__sublabel">IOTA development basics</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/chrysalis-docs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Chrysalis Docs</div><div class="link__sublabel">Mainnet documentation</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/iota.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Core</div><div class="link__sublabel">IOTA core functionality</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/wasp/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Wasp Node</div><div class="link__sublabel">Smart contract node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/bee/getting_started/getting_started"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Bee Node</div><div class="link__sublabel">IOTA node written in Rust</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/wallet.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Wallet</div><div class="link__sublabel">Build IOTA wallets</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Coordicide (IOTA 2.0)</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/hornet/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Hornet Node</div><div class="link__sublabel">IOTA node written in Go</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/stronghold.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Stronghold</div><div class="link__sublabel">Handle secrets securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a aria-current="page" class="dropdown__link dropdown__link--active" href="/IOTA-2.0-Research-Specifications/Preface"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Coordicide Specs</div><div class="link__sublabel">Decentralizing IOTA</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/identity.rs/introduction"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Identity</div><div class="link__sublabel">Identity framework</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/goshimmer/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">GoShimmer Node</div><div class="link__sublabel">IOTA 2.0 node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/streams/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Streams</div><div class="link__sublabel">Share data securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"></div></div></div></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog"><div class="link"><div class="link__body"><div class="link__label">Blog</div></div></div></a><div class="toggle toggle_3Zt9 toggle--checked toggle--disabled" role="button" tabindex="-1"><div class="toggle__icon toggle__icon--unchecked" style="font-family:Material Icons">dark_mode</div><div class="toggle__icon toggle__icon--checked" style="font-family:Material Icons">light_mode</div><input type="checkbox" checked="" class="toggle__screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_2HBr"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m"></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/preface">Preface</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/1.1 Introduction">1.1 Introduction</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.2 Message Layout">2.2 Message Layout</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.3 Standard Payloads Layout">2.3 Standard Payloads Layout</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.4 Data Flow">2.4 Data flow</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/3.3 Peer Discovery">3.3 Peer Discovery</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/3.4 Neighbor Selection">3.4 Neighbor Selection</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.1 The Tangle">4.1 The Tangle</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.2 Timestamps">4.2 Timestamps</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.3 Tip Selection Algorithm">4.3 Tip Selection Algorithm</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.4 Solidification">4.4 Solidification</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.5 Rate Control">4.5 Rate Control through Adaptive Proof of Work</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.6 Congestion Control">4.6 Congestion control</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.7 Markers">4.7 Markers</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.1 UTXO">5.1 UTXO</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.2 Ledger State">5.2 Ledger State</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.3 Mana">5.3 Mana</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">6.1 Objects of Consensus</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/IOTA-2.0-Research-Specifications/6.2 Opinion Setting">6.2 Opinion Setting</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus">6.3 Fast Probabilistic Consensus</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.4 Finalization">6.4 Approval Weight and Finality</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.5 dRNG">6.5 Distributed Random Number Generator</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>6.2 Opinion Setting</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="621-preliminaries"></a>6.2.1 Preliminaries<a class="hash-link" href="#621-preliminaries" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="6212-motivation"></a>6.2.1.2 Motivation<a class="hash-link" href="#6212-motivation" title="Direct link to heading">#</a></h3><p>FPC is a binary voting protocol which takes a series of initial boolean values, and outputs a final value: see <a href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus">Section 6.3 - Fast Probabilistic Consensus</a>.  This specification describes how to set this initial Boolean value. Specification <a href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">6.1 - Object of Consensus</a> describes how FPC interacts with other modules in the protocol, specifically how the functions <code>QueryStatus</code> and <code>AnswerStatus</code> react to the metadata <code>opinionField</code>. Moreover, the FPC specification, <a href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus">Section 6.3 - Fast Probabilistic Consensus</a>, describes how the <code>opinionField</code> is updated when FPC terminates.</p><p>We need to describe how to set the initial opinion and how to trigger FPC voting. Specifically, we need to describe how the metadata <code>opinionField</code> is initially set.  Since the outcome of FPC respects a supermajority of initial opinions, it is important that the initial opinion is set correctly.  For example, if 90% of nodes (weighted by active consensus mana) initially want to accept a transaction, the transaction is accepted with very high probablity.  </p><p>Recall from specification <a href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">Section 6.1 - Object of Consensus</a>, that <code>opinionField</code> consists of fields, <code>opinion</code> which is a boolean, <code>level</code> which is either 1,2, or 3, and <code>timeFormed</code> which is a time.  In this specification, we describe how these three fields are set for both messages and transactions.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="6213-summary"></a>6.2.1.3 Summary<a class="hash-link" href="#6213-summary" title="Direct link to heading">#</a></h3><p>In this specification, we describe how the Opinion Setter, see <a href="/IOTA-2.0-Research-Specifications/2.4 Data Flow">Section 2.4 - Data Flow</a>, initially sets <code>opinionField</code> metadata for every object being voted upon. Specifically, the opinion setter writes:</p><ul><li>The initial opinion, i.e. the initial boolean value.</li><li>The level of knowledge which dictates when FPC will be triggered.</li><li>The time the opinion was formed. </li></ul><p>See <a href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">Section 6.1 - Object of Consensus</a> for a detailed explanation of these fields. </p><p>As discussed in <a href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">Section 6.1 - Object of Consensus</a>, FPC can potentially vote on two main object types:</p><ul><li>transactions in order to resolve conflicts</li><li>timestamps in order to judge timestamps</li></ul><p>We split this specification into two main sections: the first dealing with setting the opinion on messages and their timestamps, and the second on setting the opinion on transactions.  </p><p>With regards to timestamps, we vote on whether or not the timestamp is &quot;too old&quot; when the message arrives to the node. As with voting on transactions, we can reset this opinion using the approval weight even if the node is out of sync.  </p><p>We judge transactions based on the FCoB rule, which stands for Fast Consensus of Barcelona, in honor of the research summit where the rule was first defined.  A transaction <code>X</code> satisfied the FCoB rule if the node has not received any transactions conflicting with <code>X</code> before <code>arrivalTime(X)+C</code> where <code>C</code> is the FCoB parameter.  Recall from [Section 6.4 - Finalization](./6.4 Finalization.md) that two transactions conflict if they consume the same UTXO outputs. </p><p>Intuitively, the FCoB rule only accepts a transaction if it has arrived significantly before any other conflict.  The FCoB rule guarantees that if one transaction is liked by a significant number of nodes (weighted by consensus mana), that all other conflicting transactions will be initially disliked by a supermajority of nodes, and thus rejected by FPC, guaranteeing that no two conflicting messages will be approved by FPC. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="6214-dependencies"></a>6.2.1.4 Dependencies<a class="hash-link" href="#6214-dependencies" title="Direct link to heading">#</a></h3><p>This part of the specification depends on the following specifications:</p><ul><li><a href="/IOTA-2.0-Research-Specifications/4.2 Timestamps">Section 4.2 - Timestamps</a></li><li><a href="/IOTA-2.0-Research-Specifications/5.2 Ledger State">Section 5.2 - Ledger State</a></li><li><a href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus">Section 6.1 - Object of Consensus</a></li><li><a href="/IOTA-2.0-Research-Specifications/6.4 Finalization">Section 6.4 - Finalization</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="6214-parameters-and-lists"></a>6.2.1.4 Parameters and Lists<a class="hash-link" href="#6214-parameters-and-lists" title="Direct link to heading">#</a></h3><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>DLARGE</code></td><td>duration</td><td>Gratuitous network delay estimate; set to 15 seconds</td></tr><tr><td><code>W</code></td><td>duration</td><td>Time window, set to 1 minute. Require W&gt;2DLARGE</td></tr><tr><td><code>DSMALL</code></td><td>duration</td><td>Small estimated network delay, set to 5 seconds</td></tr><tr><td><code>C</code></td><td>duration</td><td>FCoB parameter=DSMALL</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="622-timestamps"></a>6.2.2 Timestamps<a class="hash-link" href="#622-timestamps" title="Direct link to heading">#</a></h2><p>The timestamp defines the time when the message was created. Voting on timestamps ensures that nodes are issuing messages with correct timestamps, where correct means that the offset with current time is lower than a certain parameter <code>W</code>.  This time window is large to account for the network delay. In order to have consensus on the accuracy of the timestamp, and hence the eligibility of the message, we use <a href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus">FPC</a> voting, along with the levels of knowledge.  </p><p>Clearly, in order to have a correct perception of the timestamp quality, <strong>we assume the node is in sync</strong> (see section <a href="#Not-in-Sync">Not in Sync</a> otherwise).
Voting on timestamps should not occur for every message. Specifically, only for those that arrive with an offset close to <code>W</code>, i.e. within <code>DLARGE</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="6221-setting-the-initial-opinion"></a>6.2.2.1 Setting the initial opinion<a class="hash-link" href="#6221-setting-the-initial-opinion" title="Direct link to heading">#</a></h3><p>In this section, we describe how the <code>opinionField</code> is set for messages, and how we achieve consensus on the correctness of timestamps. </p><p>The opinion of timestamp is stored according to the rules laid out in the [Object of Consensus](./6.1 Objects of Consensus.md) specification.  The opinion is set by the module called the <code>OpinionManager</code>: see <a href="/IOTA-2.0-Research-Specifications/2.4 Data flow">Section 2.4 - Data Flow</a>.  Refer to the <a href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus">FPC</a> specification to see how the voting actually takes place.  </p><p>The node shall set <code>messageID.opinionField=timestampOpinion(messageID)</code>, using the function defined below.</p><p>The initial opinion and level of knowledge are set according to the following rule:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly vbnet"><pre tabindex="0" class="prism-code language-vbnet codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">FUNCTION (bool,level,time) = timestampOpinion(messageID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">time = CurrentTime()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IF messageID.arrivalTime+w &gt;= CurrentTime()  </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    opinion = TRUE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    opinion = DISLIKE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IF |messageID.arrivalTime +W - CurrentTime() | &gt;= DLARGE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    level = 2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE IF |messageID.arrivalTime +W - CurrentTime() | &gt;= 2*DLARGE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    level = 3</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    level = 1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Recall that the <code>arrivalTime.messageID</code> is the time that the message was received by the node: see <a href="/IOTA-2.0-Research-Specifications/2.2 Message Layout">Section 2.2 - Message Layout</a>.
The initial opinion is set based on the question &quot;did the transaction arrive before <code>currentTime - W</code>?&quot;.  The level of knowledge is then set by the margin as a factor of the delay time.  Specifically, under the assumption that all messages are delivered to all nodes within time <code>DLARGE</code> after the arrive (with high probability), then: </p><ul><li>If <code>|arrivalTime +W - currentTime | &lt; DLARGE</code>, then the node can make any conclusions about the arrival times of the message, and hence it has only level of knowledge 1.</li><li>If one node has <code>|arrivalTime +W - currentTime | &gt;= DLARGE </code>, then all nodes must have the same opinion, and hence that node has level of knowledge at least 2.</li><li>If one node has <code>|arrivalTime +W - currentTime | &gt;= 2*DLARGE</code>, then all nodes must have <code>|arrivalTime +W - currentTime | =&gt; DLARGE</code> guaranteeing level of knowledge 3.
<img src="https://i.imgur.com/a5or78c.png"></li></ul><p>For example, let us set <code>w</code> and <code>D</code> to 1 minute and 15 seconds respectively. Let&#x27;s assume that the current time is 12:00:00 and we have to evaluate a new message with timestamp set at 11:59:45. Since 11:59:45 +1 minute&gt;12:00:00, the node will set the opinion to <code>LIKE</code>. Moreover, since |11:59:45+1 minute-12:00:00| is greater than 15 seconds, and also grater than 2*15 seconds, the node will set the level of knowledge for this opinion to 3 (i.e., the supermajority of the network should already have the same opinion).</p><p>Consider now a new message with timestamp 11:59:10. Since 11:59:10+1 minute&gt;12:00:00, the node will set the opinion to <code>TRUE</code>. However, since |11:59:10+1 minute-12:00:00| is lower than 15 seconds, the node will set the level of knowledge for to 1, meaning that this message  will be voted upon by FPC. </p><p>In general, timestamps with level of knowledge 1 will be input into FPC, that will eventually trigger the <code>finalized</code> event, after which we may set a message as eligible or as discarded, depending on the outcome. If instead, the timestamp the node is considering has already level of knowledge larger or equal than 2, the node does not need to vote, but has to reply to queries. Either it is eligible (marked as liked) or it is marked as disliked. If the timestamp has level of knowledge 3, the node does not reply to FPC queries.</p><p>With high probability, we can be sure that for any time <code>t</code>, no node can issue a message with timestamp <code>t</code> after <code>t + W + 2*DLARGE</code>, because after this time, the message would be considered to be bad with level of knowledge 3.  Thus, assuming the node is in sync, see [Section 6.5 - Node Perception Reorganization](./6.5 Node Perception Reorganization.md), after approximately 1.5 minutes, the number of messages of a particular timestamp cannot be altered. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="623-transactions-and-fcob"></a>6.2.3 Transactions and FCoB<a class="hash-link" href="#623-transactions-and-fcob" title="Direct link to heading">#</a></h2><p>In this section, we discuss how to set the <code>opinionField</code> on transactions through the so-called FCoB rule.  Recall that a transaction <code>X</code> satisfies the FCoB rule if the node has not received any transactions conflicting with <code>X</code> before <code>arrivalTime(X)+C</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="6231-fcob-function"></a>6.2.3.1 FCoB function<a class="hash-link" href="#6231-fcob-function" title="Direct link to heading">#</a></h3><p>We now define the function <code>FCOB</code> which decides the opinion of the transaction.  When setting the opinion, the node simply sets <code>opinionField=FCOB(transactionID)</code>.  </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly vbnet"><pre tabindex="0" class="prism-code language-vbnet codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">FUNCTION (bool,level,time) = FCOB(transactionID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">time = currentTime</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IF transactionID IS NOT a conflict</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bool = TRUE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IF currentTime &lt;= transactionID.arrivalTime + C + DSMALL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ELSE IF currentTime &lt;= transactionID.arrivalTime + C + 2 * DSMALL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ELSE </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 3</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    FOR x IN conflict with transactionID</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IF x.arrivalTime &gt;= transactionID.arrivalTime + C OR ( x.opinionField.opinion == FALSE AND x.opinionField.level == 2 OR 3)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        bool = TRUE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    conflictTime= MIN(x.arrivalTime FORALL x conflicting with transactionID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IF transaction.arrivalTime + C &lt;= conflictTime </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        bool = TRUE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ELSE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        bool = FALSE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    If |transaction.arrivalTime + C - conflictTime| &lt;= DSMALL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ELSE IF |transaction.arrivalTime + C - conflictTime| &lt;= 2DSMALL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ELSE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        level = 3</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RETURN (bool,level,timeFormed)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We now will explain the logical behind this function.  There are three cases which are treated:</p><ol><li>No conflicts have been detected</li><li>Conflicts have been detected but have been rejected</li><li>Conflicts have been detected are either pending or have been confirmed</li></ol><p>Case 3 is the simplest case: since conflicts have been detected, we set the opinion according to the FCOB rule.  Then level is set according to the difference of <code>transaction.arrivalTime + C</code> and  <code>conflictTime</code>, the oldest arrival time of a conflicting transaction.  Essentially, the level measures how many network delays there are between these two values.   </p><p>In Case 1 is the most common because conflicts will never arrive for most transactions. Without conflicts, the opinion can be only set provisionally since it might change if a conflict arrives later. The opinion is set to true, but the level is set as if a conflict arrived at that time.   For example, after  <code>C + DSMALL</code> time has elapsed since arrival time, if a conflict does arrive the opinion will remain true with level at least 2.  </p><p>Lastly, Case 2 is an important special case of the FCoB rule. To see the need for this modification consider the following example.  Suppose someone issues a pair of conflicting transactions where both transactions are rejected by FPC.  Then, if someone ever issues a new transaction consuming those funds, FCoB, strictly speaking would reject the new transaction, since it would conflict with a previous transaction.  Thus, if a pair of double spends are rejected, the funds would be locked.  This is undesirable and impractical behavior: an honest but malfunctioning wallet can issue double spends.  Moreover, tracking the locked funds would be onerous. </p><p>To prevent the FCoB rule from locking funds, we modify it to the following: a transaction <code>X</code> satisfied the FCoB rule if all transactions <code>Y</code> conflicting with <code>X</code>  before <code>arrivalTime(X)+C</code> has been rejected, i.e. has has opinion false and level 2 or 3.  With this rule, any conflicts which are rejected will not affect the opinion on future conflicts.  For simplicity case, all transactions falling under this case are treated as level 1.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="6232-when-to-set-the-opinion"></a>6.2.3.2 When to set the opinion<a class="hash-link" href="#6232-when-to-set-the-opinion" title="Direct link to heading">#</a></h3><p>The protocol is actually flexible on when the opinion field of a transaction is set.  However, the node must do the following. </p><ul><li>The opinion of a transaction must be set after it is booked.  When the transaction is booked, the node searches for conflicts, and if a conflict exists the node either creates a new conflict set or else it adds the transaction to an old conflict sets.  If the <code>FCoB</code> function is called before the transaction is booked, it will be impossible to tell what conflicts exist.</li><li>The opinion field is <code>NULL</code> only if no conflicts have been detected</li><li>Fore very valid <code>transactionID</code>, the <code>transactionID.opinionField</code> is either NULL or &quot;correct&quot; at the  times <code>transactionID.arrivalTime + C + DSMALL</code> and <code>transactionID.arrivalTime + C + 2DSMALL</code>, i.e. the opinion field would be unchanged if reset at that those two times. </li></ul><p>There are a plethora of ways this could be implemented. We give two examples.  </p><p>First, after a message is booked, its transaction, say <code>transactionID</code> is added to a timed queue.  At <code>transactionID.arrivalTime + C + DSMall</code> the opinion is set, and then either the transaction is rejected (i.e. bad with level 2 or 3), voted upon (level 1), or goes to tip selection (good level 2). If no conflict has been detected, the transaction (i.e. the transaction is good level 2), the transaction is put in another timed queue.  At time <code>transactionID.arrivalTime + C + 2DSMall</code> the opinion is reset.  Note, once a conflict is detected the opinion field would not change, and so only transactions which are not part of conflict sets need to enter the second timed queue.</p><p>Second, while a transaction is being booked, conflict detection can immediately trigger setting the opinion field for all the new conflicts. This would include the transaction itself and any members of its conflict set which previously had a <code>NULL</code> opinion field. This implementation has a few caveats:</p><ul><li>Any transaction with a <code>NULL</code> opinion field must be treated as a &quot;good&quot; transaction.  At any time, the appropriate level of knowledge could be computed by looking at the arrival time.</li><li>Before the monotonically liked flag is set, the transaction must be at least <code>transactionID.arrivalTime + C + DSMall</code> and have either opinion field <code>NULL</code> or (good, level 2 or 3). </li></ul><p>Although this is an implementation detail, we remark that after a transaction is booked, it is easy to see if a message is a conflict or not. Indeed, when a conflict is detected, a new branch is created, and the ID of that new branch is the same as the <code>transactionID</code>. Thus a transaction is a conflict if and only if <code>transactionID = transactionID.branchID</code>.  See <a href="/IOTA-2.0-Research-Specifications/5.2 Ledger State">Section 5.2 - Ledger State</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/IOTA-2.0-Research-Specifications/6.1 Objects of Consensus"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 6.1 Objects of Consensus</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/IOTA-2.0-Research-Specifications/6.3 Fast Probabilistic Consensus"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">6.3 Fast Probabilistic Consensus »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#621-preliminaries" class="table-of-contents__link">6.2.1 Preliminaries</a><ul><li><a href="#6212-motivation" class="table-of-contents__link">6.2.1.2 Motivation</a></li><li><a href="#6213-summary" class="table-of-contents__link">6.2.1.3 Summary</a></li><li><a href="#6214-dependencies" class="table-of-contents__link">6.2.1.4 Dependencies</a></li><li><a href="#6214-parameters-and-lists" class="table-of-contents__link">6.2.1.4 Parameters and Lists</a></li></ul></li><li><a href="#622-timestamps" class="table-of-contents__link">6.2.2 Timestamps</a><ul><li><a href="#6221-setting-the-initial-opinion" class="table-of-contents__link">6.2.2.1 Setting the initial opinion</a></li></ul></li><li><a href="#623-transactions-and-fcob" class="table-of-contents__link">6.2.3 Transactions and FCoB</a><ul><li><a href="#6231-fcob-function" class="table-of-contents__link">6.2.3.1 FCoB function</a></li><li><a href="#6232-when-to-set-the-opinion" class="table-of-contents__link">6.2.3.2 When to set the opinion</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer padding--none"><div class="container"><div class="row footer__links padding-vert--xl"><div class="col footer__col"><h4 class="footer__title">LEARN</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/learn/about-iota/an-introduction-to-iota">About IOTA</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/iota-token/overview">IOTA Token</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/wallets/what-is-a-wallet">Wallets</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/networks/iota-1.5-chrysalis">Networks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/resource-materials/glossary">Resource Materials</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/research/research-outline">Research</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">PARTICIPATE</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/participate/support-the-network/run-a-node">Support the network</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/the-community/discord">The Community</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/partnerships/iota-partnerships">Partnerships</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/funding/edf-funding">Funding</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/use-cases/industry-applications">Use Cases</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/frameworks/introduction">Frameworks</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">BUILD</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/build/getting-started/architecture">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/build/fundamentals/cryptography">Fundamentals</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/build/exchange-integration/exchange-integration-guide">Exchange Integration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/build/tutorials/youtube">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">WIKI</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/iota-community/iota-wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://github.com/jlvandenhout/docusaurus-plugin-docs-editor" target="_blank" rel="noopener noreferrer" class="footer__link-item">Editor Github</a></li><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/contribute-to-wiki/welcome">Contribute</a></li></ul></div></div><div class="footer__bottom padding-bottom--xl"><div><a href="https://www.iota.org" target="_blank" rel="noopener noreferrer"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">© 2021 IOTA Wiki. Built with Docusaurus.</div></div></div><div class="social"><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:var(--ifm-color-gray-900)" href="https://www.youtube.com/c/iotafoundation"><img alt="Youtube" class="social__image" src="/img/youtube.svg"><div class="social__title">Youtube</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#2C3850" href="https://www.github.com/iotaledger/"><img alt="GitHub" class="social__image" src="/img/github.svg"><div class="social__title">GitHub</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#4B576F" href="https://discord.iota.org/"><img alt="Discord" class="social__image" src="/img/discord.svg"><div class="social__title">Discord</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#6A768E" href="https://www.twitter.com/iota/"><img alt="Twitter" class="social__image" src="/img/twitter.svg"><div class="social__title">Twitter</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#7D89A1" href="https://www.reddit.com/r/iota/"><img alt="Reddit" class="social__image" src="/img/reddit.svg"><div class="social__title">Reddit</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#8995AD" href="https://www.linkedin.com/company/iotafoundation/"><img alt="Linkedin" class="social__image" src="/img/linkedin.svg"><div class="social__title">Linkedin</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#99A5BD" href="https://www.instagram.com/iotafoundation/"><img alt="Instagram" class="social__image" src="/img/instagram.svg"><div class="social__title">Instagram</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#BAC6DE" href="https://www.facebook.com/TheIOTAFoundation/"><img alt="Facebook" class="social__image" src="/img/facebook.svg"><div class="social__title">Facebook</div></a></div></footer></div>
<script src="/assets/js/runtime~main.37078fcd.js"></script>
<script src="/assets/js/main.6bcab317.js"></script>
</body>
</html>