<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="IOTA Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="IOTA Wiki Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="IOTA Wiki" href="/opensearch.xml">
<link rel="preconnect" href="${matomoUrl}">
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://matomo.antonionardella.it/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","6"]);var e=document,t=e.createElement("script"),p=e.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=a+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">4.7 Markers | IOTA Wiki</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wiki.iota.org/IOTA-2.0-Research-Specifications/4.7Markers"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-IOTA-Research-Specifications-current"><meta data-react-helmet="true" property="og:title" content="4.7 Markers | IOTA Wiki"><meta data-react-helmet="true" name="description" content="The marker tool improves the efficiency with which certain properties can be checked or certain metrics calculated."><meta data-react-helmet="true" property="og:description" content="The marker tool improves the efficiency with which certain properties can be checked or certain metrics calculated."><meta data-react-helmet="true" name="keywords" content="past cone,future cone,approval weight,marker tools,sequence,dag"><meta data-react-helmet="true" property="og:image" content="https://wiki.iota.org/img/research-specifications/markers-and-marker-sequence.png"><meta data-react-helmet="true" name="twitter:image" content="https://wiki.iota.org/img/research-specifications/markers-and-marker-sequence.png"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/4.7Markers"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/4.7Markers" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/IOTA-2.0-Research-Specifications/4.7Markers" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.6a4b8713.css">
<link rel="preload" href="/assets/js/runtime~main.2c20e706.js" as="script">
<link rel="preload" href="/assets/js/main.6e2a298d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#da7ad7;color:#000000" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">Would you like to stake your tokens? <a target="_blank" href="https://assembly.sc">Read more</a> about Assembly, the upcoming permissionless Smart Contract network.</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_1VR7"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div></a><a class="navbar__item navbar__link" href="/learn/about-iota/an-introduction-to-iota"><div class="link"><div class="link__body"><div class="link__label">Learn</div></div></div></a><a class="navbar__item navbar__link" href="/participate/support-the-network/about-nodes"><div class="link"><div class="link__body"><div class="link__label">Participate</div></div></div></a><div class="dropdown dropdown--hoverable dropdown--mega"><a class="navbar__item navbar__link navbar__link--active"><div class="link"><div class="link__body"><div class="link__label">Build | Coordicide Specs</div></div></div></a><div class="dropdown__container"><div class="dropdown__menu"><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Getting Started</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Chrysalis (IOTA 1.5)</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Libraries</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Smart Contracts</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/build/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Getting Started</div><div class="link__sublabel">IOTA development basics</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/chrysalis-docs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Chrysalis Docs</div><div class="link__sublabel">Mainnet documentation</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/iota.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Client</div><div class="link__sublabel">Interact with the IOTA network</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/smart-contracts/overview"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Wasp Node</div><div class="link__sublabel">Smart contract node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Integrations</div></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/bee/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Bee Node</div><div class="link__sublabel">IOTA node written in Rust</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/wallet.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Wallet</div><div class="link__sublabel">Build IOTA wallets</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Coordicide (IOTA 2.0)</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/integration-services/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Streams and Identity</div><div class="link__sublabel">Integrate IOTA seamlessly</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/hornet/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Hornet Node</div><div class="link__sublabel">IOTA node written in Go</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/stronghold.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Stronghold</div><div class="link__sublabel">Handle secrets securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a aria-current="page" class="dropdown__link dropdown__link--active" href="/IOTA-2.0-Research-Specifications/Preface"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Coordicide Specs</div><div class="link__sublabel">Decentralizing IOTA</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/chronicle.rs/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Chronicle Permanode</div><div class="link__sublabel">IOTA permanode</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/identity.rs/introduction"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Identity</div><div class="link__sublabel">Identity framework</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/goshimmer/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">GoShimmer Node</div><div class="link__sublabel">IOTA 2.0 node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/streams/welcome"><div class="link"><div class="link__icon"></div><div class="link__body"><div class="link__label">Streams</div><div class="link__sublabel">Share data securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div></div></div></div></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog"><div class="link"><div class="link__body"><div class="link__label">Blog</div></div></div></a><a class="navbar__item navbar__link" href="/team"><div class="link"><div class="link__body"><div class="link__label">Team</div></div></div></a><div class="navbar__item navbar__item--dock"><div class="toggle toggle_2xs0 toggle--checked toggle--disabled" role="button" tabindex="-1"><div class="toggle__icon toggle__icon--unchecked" style="font-family:Material Icons">dark_mode</div><div class="toggle__icon toggle__icon--checked" style="font-family:Material Icons">light_mode</div><input type="checkbox" checked="" class="toggle__screenreader-only" aria-label="Switch between dark and light mode"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m"></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/preface">Preface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/1.1Introduction">1.1 Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.2MessageLayout">2.2 Message Layout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.3StandardPayloadsLayout">2.3 Standard Payloads Layout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/2.4DataFlow">2.4 Data flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/3.3PeerDiscovery">3.3 Peer Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/3.4NeighborSelection">3.4 Neighbor Selection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/3.5 Manual Peering">3.5 Manual Peering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.1TheTangle">4.1 The Tangle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.2Timestamps">4.2 Timestamps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.3TipSelectionAlgorithm">4.3 Tip Selection Algorithm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.4Solidification">4.4 Solidification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.5RateControl">4.5 Rate Control through Adaptive Proof of Work</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/4.6CongestionControl">4.6 Congestion control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/IOTA-2.0-Research-Specifications/4.7Markers">4.7 Markers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.1UTXO">5.1 UTXO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.2LedgerState">5.2 Ledger State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/5.3Mana">5.3 Mana</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.1ObjectsOfConsensus">6.1 Objects of Consensus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.2OpinionSetting">6.2 Opinion Setting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.3FastProbabilisticConsensus">6.3 Fast Probabilistic Consensus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.4Finalization">6.4 Approval Weight and Finality</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/IOTA-2.0-Research-Specifications/6.5dRNG">6.5 Distributed Random Number Generator</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>4.7 Markers</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="471-introduction">4.7.1 Introduction<a class="hash-link" href="#471-introduction" title="Direct link to heading">​</a></h2><p>This section specifies the requirements for the <em>marker</em> tool. A tool as defined here is a feature that adds functionality to the node software but is not an essential component. The marker tool improves the efficiency with which certain properties can be checked or certain metrics calculated.</p><p>The potential issues addressed by the use of the marker tool are in handling potentially numerically expensive operations. Specifically, the following operations can become numerically expensive:</p><ul><li><strong>Future- or past cone inclusion</strong>. For certain applications it is necessary to know whether a certain message is in the past or future cone of another message. In the default approach the Tangle has to be walked until a given message is found.</li><li><strong>Approval weight</strong>. In order to compute the approval weight of a given message the node software needs to traverse the Tangle from that message to the tips and sum up the active consensus Mana of all the messages in its future cone, see also the section on <a href="/IOTA-2.0-Research-Specifications/6.2OpinionSetting">approval weight</a>.</li></ul><p>The marker tool allows a node to efficiently determine whether certain markers are in the past or future cone of a given message, by reducing the proportion of the Tangle that needs to be traversed. </p><p>The marker tool achieves this by defining a parallel internal data structure, consisting of additional metadata applied to specific messages in the Tangle. Specifically, the marker tool &quot;marks&quot; certain messages, which form a subDAG which approximates the topological structure of the Tangle.  Furthermore, the markers are grouped into sequences (which themselves form yet another DAG), which allow the node to quickly determine which markers reference each other.  </p><p>Note, that we <em>shall</em> require that markers are assigned when booking a message. Thus, for that part of the message DAG that is already booked the corresponding marker DAG does not change anymore. </p><p>The <em>Markers</em> tool specification depends on:</p><ul><li><a href="/IOTA-2.0-Research-Specifications/4.1TheTangle">4.1 - The Tangle</a></li><li><a href="/IOTA-2.0-Research-Specifications/5.2LedgerState">5.2 - Ledger State</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="472-definitions">4.7.2 Definitions<a class="hash-link" href="#472-definitions" title="Direct link to heading">​</a></h2><p>The following terms are defined in relation to markers:</p><ul><li><strong>UTXO branch:</strong> This is a set of outputs that spawn off from a conflict transaction. Each UTXO branch by itself is conflict free. See also <a href="/IOTA-2.0-Research-Specifications/5.1UTXO">Section 5.1 - UTXO</a> and <a href="/IOTA-2.0-Research-Specifications/5.2LedgerState">Section 5.2 - Ledger State</a> for a more complete discussion on UTXO and its branches.</li><li><strong>Aggregated branch:</strong> The aggregation of a combination of several branches.</li><li><strong>Branch identifier (<code>BID</code>):</strong> The unique identifier of a branch or aggregated branch.</li><li><strong>Main branch:</strong> The part of the UTXO DAG, in which all outputs are considered to be good in the sense that all conflicts in their past have been resolved, either by a given conflict being accepted or rejected. </li><li><strong>Rank:</strong> The length of the longest directed path in DAG terminating in a given vertex/object. Specifically, if a vertex <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal">A</span></span></span></span></span> directly references only <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.05017em">B</span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span></span></span></span></span> then <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>a</mi><mi>n</mi><mi>k</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>k</mi><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>k</mi><mo stretchy="false">(</mo><mi>C</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">rank(A)=max(rank(B),rank(C))+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em">B</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span>.</li><li><strong>Marker:</strong> A message that is assigned additional properties locally on the node, and that tracks a particular UTXO branch.</li><li><strong>Marker identifier (<code>MID</code>):</strong> The unique identifier of the marker.</li><li><strong>Marker DAG:</strong> The collection of all markers. </li><li><strong>Marker rank (<code>MR</code>):</strong> The rank of a marker in the marker DAG.</li><li><strong>Marker-sequence:</strong> A marker-sequence is a group of markers. Each marker-sequence maps to a UTXO branch; see <a href="/IOTA-2.0-Research-Specifications/5.2LedgerState">Section 5.2 - Ledger State</a>.</li><li><strong>Marker-sequence identifier (<code>SID</code>):</strong> A marker-sequence identifier is a number that uniquely identifies a marker-sequence.</li><li><strong>Marker-sequence rank (<code>SR</code>):</strong> The rank of a marker-sequence in the marker-sequence DAG.</li><li><strong>Future marker (<code>FM</code>):</strong> This field in the <!-- -->[message metadata]<!-- -->(## 4.7.5 Message Metadata) is (potentially) updated when a new marker is generated in the future cone of the message, following the rules defined in Section &quot;Message Metadata&quot;. Essentially it contains the list of markers for which there is no other marker between the marker in question and the message, or in more mathematical terms, the minimal markers in the future cone.</li><li><strong>Past marker (<code>PM</code>):</strong> A past marker of a message is a most recent past marker of the parents (with respect to <code>MR</code>). The past marker of a marker is set to itself.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="473-the-markers">4.7.3 The markers<a class="hash-link" href="#473-the-markers" title="Direct link to heading">​</a></h2><p>A marker consists of the following data:</p><table><tr><th>Variable</th><th>Type</th><th>Description</th></tr><tr><td><code>MID</code></td><td>uint64</td><td>Unique identifier of the marker</td></tr><tr><td><code>SID</code></td><td>uint64</td><td>Unique identifier of the marker-sequence</td></tr><tr><td><code>MR</code></td><td>uint64</td><td>Marker rank</td></tr></table><p><strong>Table 4.7.1:</strong> Marker data.</p><p>A new marker <em>shall</em> be created by the marker tool when any of the following conditions are met: </p><ul><li>a new UTXO branch is created and the message that would get a marker assigned is not yet booked. This also creates a new marker-sequence.</li><li>more than a certain number of messages (<code>maxMsgPerMarker</code>) have been received since the last marker.  This rule must be applied per marker-sequence. I.e. for each marker-sequence with more than <code>maxMsgPerMarker</code> since the last marker in that marker-sequence, the rule <em>shall</em> be applied independently.</li><li>a certain time window (<code>maxTimePerMarker</code>) has passed since the last marker. </li></ul><p>A marker is created with a <code>MID</code>, an this <code>MID</code> must be unique. </p><p>To set a new  marker within a marker-sequence, the marker tool randomly selects from strong tips set a message whose past marker is the last marker in the sequence. The next marker will then reference that transaction. If there is no strong tip with the appropriate past marker, the selection <em>shall</em> be from message in the weak tips set. The rank of the new marker should be one greater than the rank of all the past markers of the message.  </p><p>Since <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">MR</mtext><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mo>+</mo><munder><mo><mi>max</mi><mo>⁡</mo></mo><mrow><mi>y</mi><mo>:</mo><mi>x</mi><mtext> references </mtext><mi>y</mi></mrow></munder><mtext mathvariant="monospace">MR</mtext><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\texttt{MR}(x)=1+\max \limits_{y: x\text{ references }y}\texttt{MR}(y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord text"><span class="mord texttt">MR</span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.638216em;vertical-align:-0.8882159999999999em"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.43055999999999994em"><span style="top:-2.3478920000000003em;margin-left:0em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span><span class="mrel mtight">:</span><span class="mord mathnormal mtight">x</span><span class="mord text mtight"><span class="mord mtight"> references </span></span><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8882159999999999em"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord text"><span class="mord texttt">MR</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mclose">)</span></span></span></span></span>, marker ranks are monotonically non-decreasing such that
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∀</mi><mi>x</mi><mo>∈</mo><mi>f</mi><mi>c</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><mo>⇒</mo><msub><mtext mathvariant="monospace">MR</mtext><mi>x</mi></msub><mo>&gt;</mo><msub><mtext mathvariant="monospace">MR</mtext><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">\forall x \in fc(y) \Rightarrow \texttt{MR}_x &gt; \texttt{MR}_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em"></span><span class="mord">∀</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">c</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.7611100000000001em;vertical-align:-0.15em"></span><span class="mord"><span class="mord text"><span class="mord texttt">MR</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.8972180000000001em;vertical-align:-0.286108em"></span><span class="mord"><span class="mord text"><span class="mord texttt">MR</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span></span></span></span></span>,
where <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>c</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">fc(y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="mord mathnormal">c</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mclose">)</span></span></span></span></span> is the future cone of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="474-the-marker-sequence">4.7.4 The marker-sequence<a class="hash-link" href="#474-the-marker-sequence" title="Direct link to heading">​</a></h2><p>Marker-sequences are used to track the UTXO DAG branches. Each branch corresponds to a marker-sequence with a unique <code>SID</code>, and the marker-sequences form a DAG. </p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="4741-marker-sequence-data">4.7.4.1 Marker-sequence data<a class="hash-link" href="#4741-marker-sequence-data" title="Direct link to heading">​</a></h3><p>Each marker-sequence is associated with the following data:</p><table><tr><th>Variable</th><th>Type</th><th>Description</th></tr><tr><td><code>SID</code></td><td>unit64</td><td>The marker-sequence identifier</td></tr><tr><td><code>SR</code></td><td>unit64</td><td>The rank of a marker-sequence in the marker-sequence DAG</td></tr><tr><td><code>MRMax</code></td><td>unit64</td><td>The highest <code>MR</code> in the marker-sequence</td></tr><tr><td><code>MRMin</code></td><td>unit64</td><td>The lowest <code>MR</code> in the marker-sequence</td></tr><tr><td><code>ParentReferences </code></td><td>map[<code>Marker</code>] <code>Marker</code></td><td>Relationship map from parent marker-sequences to markers (*) </td></tr></table><p><strong>Table 4.7.2:</strong> Data associated to a marker-sequence.</p><p>*The field <code>ParentReferences</code> models the relationship between marker-sequences. This maps which marker in this marker-sequence references which other markers from other marker-sequences. </p><p>Whenever a new marker is added that is a member of a given marker-sequence, <code>MR_max</code> and <code>ParentReferences</code> for that marker-sequence <em>shall</em> be updated. </p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="4742-creation-of-marker-sequences">4.7.4.2 Creation of marker-sequences<a class="hash-link" href="#4742-creation-of-marker-sequences" title="Direct link to heading">​</a></h3><p>A new marker-sequence <em>shall</em> be created when:</p><ol><li>there&#x27;s a transaction that creates a new conflict, i.e. creates a new UTXO branch.</li><li>the UTXO branches are aggregated.</li><li>UTXO branches are merged.</li></ol><p>Each new marker-sequence <em>shall</em> start with a new marker. Hence, with the creation of a new marker-sequence also a new marker <em>must</em> be assigned to the message that caused one of the three above events.</p><p>Whenever a new marker-sequence is created, the marker tool <em>shall</em> assign:</p><ul><li>a new <code>SID</code>, created by the rule <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>new </mtext><mtext mathvariant="monospace">SID</mtext><mo>=</mo><mn>1</mn><mo>+</mo><mtext>last </mtext><mtext mathvariant="monospace">SID</mtext></mrow><annotation encoding="application/x-tex">\text{new }\texttt{SID}=1+\text{last } \texttt{SID}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61111em;vertical-align:0em"></span><span class="mord text"><span class="mord">new </span></span><span class="mord text"><span class="mord texttt">SID</span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord text"><span class="mord">last </span></span><span class="mord text"><span class="mord texttt">SID</span></span></span></span></span></span>. A new created <code>SID</code> must be unique. </li><li>a new <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">SR</mtext><mo>=</mo><mn>1</mn><mo>+</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mtext>referenced </mtext><mtext mathvariant="monospace">SR</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\texttt{SR}=1+max(\text{referenced }\texttt{SR})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61111em;vertical-align:0em"></span><span class="mord text"><span class="mord texttt">SR</span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord text"><span class="mord">referenced </span></span><span class="mord text"><span class="mord texttt">SR</span></span><span class="mclose">)</span></span></span></span></span>.
To prevent assigning a new <code>SID</code> when combining the same marker-sequences at different times, the marker tool <em>shall</em> build parent-child relationships in a map whenever a new marker-sequence is created. </li></ul><p>For further details about the UTXO model, please refer to the section on <a href="/IOTA-2.0-Research-Specifications/5.1UTXO">UTXO</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="475-message-metadata">4.7.5 Message Metadata<a class="hash-link" href="#475-message-metadata" title="Direct link to heading">​</a></h2><p>For each message in the Tangle, the marker tool <em>shall</em> maintain metadata that provides information about the markers that are closest in the past or future cone of that message, as well as whether the message itself is a marker and what rank the message has. The following message metadata <em>shall</em> be defined in the marker tool to support that requirement:</p><table><tr><th>Variable</th><th>Type</th><th>Description</th></tr><tr><td><code>IsMarker</code></td><td>bool</td><td>A flag to indicate whether a message is a marker.</td></tr><tr><td><code>PastMarkers</code></td><td>map[<code>SID</code>]<code>MID</code></td><td>A list of the closest markers from different marker-sequences in the past cone of the message.</td></tr><tr><td><code>FutureMarkers</code></td><td>map[<code>SID</code>]<code>MID</code></td><td>A list of the closest markers from different marker-sequences in the future cone of the message.</td></tr><tr><td><code>MarkerBranchID</code></td><td><code>BID</code></td><td>The branch ID to which the marker is mapped, or <code>nil</code> if the message is no marker.</td></tr><tr><td><code>PayloadBranchID</code></td><td><code>BID</code></td><td>The branch ID to which the Payload is mapped in case it is a conflict, or <code>nil</code> otherwise.</td></tr><tr><td><code>IndividualBranchID</code></td><td><code>BID</code></td><td>The branch ID if there is need for mapping the message individually to a branch ID, or <code>nil</code> otherwise.</td></tr></table><p><strong>Table 4.7.3:</strong> Markers metadata.  </p><p>The <code>PastMarkers</code> field contains </p><ul><li>only the marker identifier of itself, if the message is marked as a marker.</li><li>the marker identifier of its closest past markers (PMs), i.e. from each referenced marker-sequence only the markers with the highest marker rank (<code>MR</code>). Markers which are referenced by other markers in this list <em>shall</em> be removed.</li></ul><p>The <code>FutureMarkers</code> list <em>shall</em> be empty at the start and <em>shall</em> be updated when a new marker directly or indirectly references that list. </p><p>The propagation of a FM to its past cone (i.e. the update of the <code>FutureMarkers</code> list in the encountered messages) <em>shall</em> not continue beyond a message if:</p><ol><li><code>FutureMarkers</code> of a message includes a previous marker of the same marker-sequence; the message that includes such a marker <em>shall</em> not get updated.</li><li>the message is the marker in a different marker-sequence. Then the <code>FutureMarkers</code> <em>shall</em> be updated for that marker only.</li></ol><p>Through this approach past and future markers do not cross weak parents. It also prevents the lists from growing unboundedly.</p><p>The fields <code>MarkerBranchID</code>, <code>PayloadBranchID</code> and <code>IndividualBranchID</code> allow for making connections between the marker DAG, the message DAG and the UTXO branch DAG. When a new Sequence is created the <code>MarkerBranchID</code> is set to the branch that creates the sequence.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="4751-update-of-already-booked-messages-on-double-spends">4.7.5.1 Update of already booked messages on double spends<a class="hash-link" href="#4751-update-of-already-booked-messages-on-double-spends" title="Direct link to heading">​</a></h3><p>If a transaction arrives that double spends an already booked transaction, a new marker-sequence <em>shall</em> be created for the newly arrived message (containing the transaction), see Section <!-- -->[Creation of marker-sequences]<!-- -->(# 4.7.4.2 Creation of Marker-sequences).</p><p>For the already booked conflicting transaction <strong>no</strong> new marker or marker Sequence <em>shall</em> be created. This is because the marker DAG and Sequence DAG <em>shall</em> not be changed post-booking a message. However a new UTXO branch is created.</p><p>First, assume the existing booked transaction is a Marker itself. Then the marker gets mapped onto the new branch by updating the field <code>MarkerBranchID</code> in the message metadata. Furthermore, the <code>PayloadBranchID</code> is updated to the new branch. For all FM in the same sequence the <code>MarkerBranchID</code> gets updated to the new branch. Furthermore, for every sequence that directly or indirectly references the sequence in which the double-spend occurs, the first marker is remapped to the new branch as well.</p><p>Second, assume the existing transaction is not a marker. Then all messages between the transaction and the following future markers (including the transaction itself) get mapped individually to the new branch mapping using the field <code>IndividualBranchID</code>. From the future markers onwards, the same applies as in the first scenario. </p><p>For an example implementation of these scenarios also visit the example <a href="https://github.com/iotaledger/goshimmer/blob/develop/packages/tangle/images/TestBookerMarkerMappings.md" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="476-marker-application-description">4.7.6 Marker Application Description<a class="hash-link" href="#476-marker-application-description" title="Direct link to heading">​</a></h2><p>Figure 1 shows an example of how the markers and marker-sequences (here also called Sequence) would look in the Tangle from the perspective of the Message DAG, the marker DAG and the marker-sequence DAG. The purple colored messages are markers:</p><p><a target="_blank" href="/assets/files/tangle-epochs-a5cf3d36adfa8fd6491636b7b9ae142b.png"><img alt="Markers and marker-sequences in the tangle" src="/assets/images/markers-and-marker-sequence-670c675a90452a0642316170a5abe1f5.png" class="fullscreen-image__source"></a></p><p><strong>Image 4.7.4:</strong> Markers and marker-sequences in the Tangle.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="4761-example-implementation">4.7.6.1 Example Implementation<a class="hash-link" href="#4761-example-implementation" title="Direct link to heading">​</a></h3><p>An illustrative example of the markers tool in action is provided <a href="https://github.com/iotaledger/goshimmer/blob/develop/packages/tangle/images/TestBookerMarkerMappings.md" target="_blank" rel="noopener noreferrer">here</a> for the prototype implementation. </p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="4762-approval-weight-approximation">4.7.6.2 Approval weight approximation<a class="hash-link" href="#4762-approval-weight-approximation" title="Direct link to heading">​</a></h3><p>To approximate the approval weight of a message, the markers tool retrieves the approval weight of <code>FutureMarkers</code>. Since a given message is in the past cone of its FMs, the approval weight and thus the finality of the message will be at least the same as the maximum weight of its FMs. This gives a lower bound (which is the “safe” bound), and if the markers are set frequently enough, this provides a good approximation of that bound. </p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="4763-past-cone-check">4.7.6.3 Past cone check<a class="hash-link" href="#4763-past-cone-check" title="Direct link to heading">​</a></h3><p>By comparing the <code>PastMarkers</code> of a message with the <code>FutureMarkers</code> of another message, the markers tool can determine if that message is in the past cone of the other. For example, consider two messages <code>X</code> and <code>Y</code> that are members in the same marker-sequence. Then if <code>PM(X)&gt;FM(Y)</code>, then <code>X</code> is in the future of <code>Y</code>.</p><p>One way in which this check can be carried out is by traversing the marker DAG while remaining in the bounds of the marker ranks. </p><p>A potential optimization is that the marker-sequence DAG can be traversed while considering the marker-sequence ranks, prior to any traversal of the marker DAG.</p><p>It is possible that the marker DAG does not cover certain areas of the message DAG at a given point in time. In this case, a check on this question can return one of the following three values:</p><ul><li><code>TRUE</code> </li><li><code>FALSE</code> </li><li><code>N/A</code></li></ul><p>If the check returns a <code>N/A</code>, then the Message DAG must be searched via a search algorithm.</p><p>For an example implementation of the algorithm for the past cone check visit <a href="https://goshimmer.docs.iota.org/docs/protocol_specification/markers" target="_blank" rel="noopener noreferrer">GoShimmer markers</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/iotaledger/IOTA-2.0-Research-Specifications/edit/docusaurus/docs/4.7Markers.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/IOTA-2.0-Research-Specifications/4.6CongestionControl"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">4.6 Congestion control</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/IOTA-2.0-Research-Specifications/5.1UTXO"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">5.1 UTXO</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#471-introduction" class="table-of-contents__link toc-highlight">4.7.1 Introduction</a></li><li><a href="#472-definitions" class="table-of-contents__link toc-highlight">4.7.2 Definitions</a></li><li><a href="#473-the-markers" class="table-of-contents__link toc-highlight">4.7.3 The markers</a></li><li><a href="#474-the-marker-sequence" class="table-of-contents__link toc-highlight">4.7.4 The marker-sequence</a><ul><li><a href="#4741-marker-sequence-data" class="table-of-contents__link toc-highlight">4.7.4.1 Marker-sequence data</a></li><li><a href="#4742-creation-of-marker-sequences" class="table-of-contents__link toc-highlight">4.7.4.2 Creation of marker-sequences</a></li></ul></li><li><a href="#475-message-metadata" class="table-of-contents__link toc-highlight">4.7.5 Message Metadata</a><ul><li><a href="#4751-update-of-already-booked-messages-on-double-spends" class="table-of-contents__link toc-highlight">4.7.5.1 Update of already booked messages on double spends</a></li></ul></li><li><a href="#476-marker-application-description" class="table-of-contents__link toc-highlight">4.7.6 Marker Application Description</a><ul><li><a href="#4761-example-implementation" class="table-of-contents__link toc-highlight">4.7.6.1 Example Implementation</a></li><li><a href="#4762-approval-weight-approximation" class="table-of-contents__link toc-highlight">4.7.6.2 Approval weight approximation</a></li><li><a href="#4763-past-cone-check" class="table-of-contents__link toc-highlight">4.7.6.3 Past cone check</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer padding--none"><div class="container"><div class="row footer__links padding-vert--xl"><div class="col footer__col"><h4 class="footer__title">LEARN</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/learn/about-iota/an-introduction-to-iota">About IOTA</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/iota-token/buying-iota">IOTA Token</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/wallets/what-is-a-wallet">Wallets</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/networks/iota-1.5-chrysalis">Networks</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/glossary">Glossary</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/research/research-outline">Research</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/future/future-of-iota">Future of IOTA</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">PARTICIPATE</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/participate/support-the-network/about-nodes">Support the network</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/the-community/discord">The Community</a></li><li class="footer__item"><a href="https://www.iota.org/solutions/partnerships" target="_blank" rel="noopener noreferrer" class="footer__link-item">Partnerships</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/funding/edf-funding">Funding</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/use-cases/industry-applications">Use Cases</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/frameworks/introduction">Frameworks</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">BUILD</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/build/welcome">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/build/fundamentals/cryptography">Fundamentals</a></li><li class="footer__item"><a class="footer__link-item" href="/build/exchange-integration/exchange-integration-guide">Exchange Integration</a></li><li class="footer__item"><a class="footer__link-item" href="/build/tutorials/twitch">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">WIKI</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/team">Team</a></li><li class="footer__item"><a href="https://github.com/iota-community/iota-wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://github.com/jlvandenhout/docusaurus-plugin-docs-editor" target="_blank" rel="noopener noreferrer" class="footer__link-item">Editor Github</a></li><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/contribute-to-wiki/welcome">Contribute</a></li></ul></div></div><div class="footer__bottom padding-bottom--xl"><div><a href="https://www.iota.org" target="_blank" rel="noopener noreferrer"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">© 2022 IOTA Wiki. Built with Docusaurus.</div></div></div><div class="social"><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:var(--ifm-color-gray-900)" href="https://www.youtube.com/c/iotafoundation"><div class="social__font social__icon"></div><div class="social__title">Youtube</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#2C3850" href="https://www.github.com/iotaledger/"><div class="social__font social__icon"></div><div class="social__title">GitHub</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#4B576F" href="https://discord.iota.org/"><div class="social__font social__icon"></div><div class="social__title">Discord</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#6A768E" href="https://www.twitter.com/iota/"><div class="social__font social__icon"></div><div class="social__title">Twitter</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#7D89A1" href="https://www.reddit.com/r/iota/"><div class="social__font social__icon"></div><div class="social__title">Reddit</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#8995AD" href="https://www.linkedin.com/company/iotafoundation/"><div class="social__font social__icon"></div><div class="social__title">LinkedIn</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#99A5BD" href="https://www.instagram.com/iotafoundation/"><div class="social__font social__icon"></div><div class="social__title">Instagram</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#BAC6DE" href="https://www.facebook.com/TheIOTAFoundation/"><div class="social__font social__icon"></div><div class="social__title">Facebook</div></a></div></footer></div>
<script src="/assets/js/runtime~main.2c20e706.js"></script>
<script src="/assets/js/main.6e2a298d.js"></script>
</body>
</html>