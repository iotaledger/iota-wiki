<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="IOTA Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="IOTA Wiki Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="IOTA Wiki" href="/opensearch.xml">
<link rel="preconnect" href="${matomoUrl}">
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://matomo.antonionardella.it/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","6"]);var e=document,t=e.createElement("script"),p=e.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=a+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">Markers | IOTA Wiki</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wiki.iota.org/goshimmer/protocol_specification/components/markers"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-goshimmer-current"><meta data-react-helmet="true" property="og:title" content="Markers | IOTA Wiki"><meta data-react-helmet="true" name="description" content="Markers is a tool to efficiently estimate the approval weight of a message and that reduces the portion of the Tangle that needs to be traversed, and which finally results in the grade of finality."><meta data-react-helmet="true" property="og:description" content="Markers is a tool to efficiently estimate the approval weight of a message and that reduces the portion of the Tangle that needs to be traversed, and which finally results in the grade of finality."><meta data-react-helmet="true" name="keywords" content="approval weight,marker,message,sequence,future marker,new marker,part marker,past cone"><meta data-react-helmet="true" property="og:image" content="https://wiki.iota.org/img/protocol_specification/example_1.png"><meta data-react-helmet="true" name="twitter:image" content="https://wiki.iota.org/img/protocol_specification/example_1.png"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wiki.iota.org/goshimmer/protocol_specification/components/markers"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/goshimmer/protocol_specification/components/markers" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/goshimmer/protocol_specification/components/markers" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.7b95f14d.css">
<link rel="preload" href="/assets/js/runtime~main.6a9f2868.js" as="script">
<link rel="preload" href="/assets/js/main.1ac64b7d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#da7ad7;color:#000000" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">Would you like to stake your tokens? <a target="_blank" href="https://assembly.sc">Read more</a> about Assembly, the upcoming permissionless Smart Contract network.</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_1VR7"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div></a><a class="navbar__item navbar__link" href="/learn/about-iota/an-introduction-to-iota"><div class="link"><div class="link__body"><div class="link__label">Learn</div></div></div></a><a class="navbar__item navbar__link" href="/participate/support-the-network/about-nodes"><div class="link"><div class="link__body"><div class="link__label">Participate</div></div></div></a><div class="dropdown dropdown--hoverable dropdown--mega"><a class="navbar__item navbar__link navbar__link--active"><div class="link"><div class="link__body"><div class="link__label">Build | GoShimmer Node</div></div></div></a><div class="dropdown__container"><div class="dropdown__menu"><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Getting Started</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Chrysalis (IOTA 1.5)</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Libraries</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Smart Contracts</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/build/welcome"><div class="link"><div class="link__icon">Ó§Ç</div><div class="link__body"><div class="link__label">Getting Started</div><div class="link__sublabel">IOTA development basics</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/chrysalis-docs/welcome"><div class="link"><div class="link__icon">Ó§Å</div><div class="link__body"><div class="link__label">Chrysalis Docs</div><div class="link__sublabel">Mainnet documentation</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/iota.rs/welcome"><div class="link"><div class="link__icon">Ó§á</div><div class="link__body"><div class="link__label">Client</div><div class="link__sublabel">Interact with the IOTA network</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/smart-contracts/overview"><div class="link"><div class="link__icon">Ó§ã</div><div class="link__body"><div class="link__label">Wasp Node</div><div class="link__sublabel">Smart contract node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/bee/welcome"><div class="link"><div class="link__icon">Ó§Ä</div><div class="link__body"><div class="link__label">Bee Node</div><div class="link__sublabel">IOTA node written in Rust</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/wallet.rs/welcome"><div class="link"><div class="link__icon">Ó§ä</div><div class="link__body"><div class="link__label">Wallet</div><div class="link__sublabel">Build IOTA wallets</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Coordicide (IOTA 2.0)</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/hornet/welcome"><div class="link"><div class="link__icon">Ó§Ñ</div><div class="link__body"><div class="link__label">Hornet Node</div><div class="link__sublabel">IOTA node written in Go</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/stronghold.rs/welcome"><div class="link"><div class="link__icon">Ó§â</div><div class="link__body"><div class="link__label">Stronghold</div><div class="link__sublabel">Handle secrets securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/IOTA-2.0-Research-Specifications/Preface"><div class="link"><div class="link__icon">Ó§Ü</div><div class="link__body"><div class="link__label">Coordicide Specs</div><div class="link__sublabel">Decentralizing IOTA</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/chronicle.rs/welcome"><div class="link"><div class="link__icon">Ó§å</div><div class="link__body"><div class="link__label">Chronicle Permanode</div><div class="link__sublabel">IOTA permanode</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/identity.rs/introduction"><div class="link"><div class="link__icon">Ó§Ö</div><div class="link__body"><div class="link__label">Identity</div><div class="link__sublabel">Identity framework</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a aria-current="page" class="dropdown__link dropdown__link--active" href="/goshimmer/welcome"><div class="link"><div class="link__icon">Ó§É</div><div class="link__body"><div class="link__label">GoShimmer Node</div><div class="link__sublabel">IOTA 2.0 node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/streams/welcome"><div class="link"><div class="link__icon">Ó§à</div><div class="link__body"><div class="link__label">Streams</div><div class="link__sublabel">Share data securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"></div></div></div></div></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog"><div class="link"><div class="link__body"><div class="link__label">Blog</div></div></div></a><a class="navbar__item navbar__link" href="/team"><div class="link"><div class="link__body"><div class="link__label">Team</div></div></div></a><div class="navbar__item navbar__item--dock"><div class="toggle toggle_2xs0 toggle--checked toggle--disabled" role="button" tabindex="-1"><div class="toggle__icon toggle__icon--unchecked" style="font-family:Material Icons">dark_mode</div><div class="toggle__icon toggle__icon--checked" style="font-family:Material Icons">light_mode</div><input type="checkbox" checked="" class="toggle__screenreader-only" aria-label="Switch between dark and light mode"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m"></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/goshimmer/welcome">Welcome</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/goshimmer/faq">FAQ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/goshimmer/tutorials/setup">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/goshimmer/implementation_design/event_driven_model">Implementation design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" href="/goshimmer/protocol_specification/overview">Protocol Specification</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goshimmer/protocol_specification/overview">Protocol Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goshimmer/protocol_specification/protocol">Protocol High Level Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_2fq0" tabindex="0" href="/goshimmer/protocol_specification/components/overview">Components</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/goshimmer/protocol_specification/components/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/goshimmer/protocol_specification/components/tangle">Tangle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/goshimmer/protocol_specification/components/autopeering">Autopeering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/goshimmer/protocol_specification/components/mana">Mana</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/goshimmer/protocol_specification/components/congestion_control">Congestion Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/goshimmer/protocol_specification/components/consensus_mechanism">Consensus Mechanism</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/goshimmer/protocol_specification/components/ledgerstate">UTXO and Ledgerstate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/goshimmer/protocol_specification/components/advanced_outputs">Advanced Outputs (Experimental)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/goshimmer/protocol_specification/components/markers">Markers</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/goshimmer/protocol_specification/glossary">Glossary</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/goshimmer/apis/client_lib">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/goshimmer/tooling/overview">Tooling</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/goshimmer/teamresources/release">Team Resources</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/iotaledger/goshimmer/releases" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Release Notes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Markers</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">‚Äã</a></h2><p>In order to know whether a message in the Tangle is orphaned or not, we introduce <strong>grades of finality</strong> to interpret the status of a message. The higher grade of finality is determined by the <strong>approval weight</strong>, which is the proportion of active consensus mana approving a given message.</p><p>To compute the approval weight of a given message we need to traverse the Tangle from the message to the tips and sum up the active consensus mana of all the messages in its future cone. The <strong>marker</strong> tool is a tool to efficiently estimate the approval weight of a message and that reduces the portion of the Tangle that needs to be traversed, and which finally results in the grade of finality.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>NOte</h5></div><div class="admonition-content"><p><strong>Markers</strong> is not a core module of the Coordicide project.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="motivation">Motivation<a class="hash-link" href="#motivation" title="Direct link to heading">‚Äã</a></h2><p><em>Markers</em> is a tool to infer knowledge about the structure of the Tangle in terms of:</p><ul><li>past/future cone membership;</li><li>approximate approval weight of any message;</li><li>tagging sections of the Tangle (e.g., branches) without having to traverse each message individually.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="dependency">Dependency<a class="hash-link" href="#dependency" title="Direct link to heading">‚Äã</a></h2><p>Active Consensus Mana</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="definitions">Definitions<a class="hash-link" href="#definitions" title="Direct link to heading">‚Äã</a></h2><p>Let&#x27;s define the terms related to markers:</p><ul><li><strong>Sequence:</strong> A Sequence is a sequence of markers. Each Sequence corresponds to a UTXO branch, which help us to track the structure independently. </li><li><strong>Sequence Identifier (<code>SID</code>):</strong> A Sequence Identifier is the unique identifier of a Sequence.</li><li><strong>Marker Index (<code>MI</code>):</strong> A Marker Index is the marker rank in the marker DAG. Throughout the code the marker rank will be called index. </li><li><strong>marker:</strong> A marker is a pair of numbers: <code>SID</code> and <code>MI</code> associated to a given message. Markers carrying the same <code>SID</code> belong to the same Sequence.</li><li><strong>future marker (<code>FM</code>):</strong> A future marker of a message is the first marker in its future cone from different sequences; this field in the message metadata is updated when the new marker is generated in the future, following the rules defined in <a href="#future-markers">Future Markers</a>.</li><li><strong>past marker (<code>PM</code>):</strong> A past marker of a message is a marker in its past cone. For a given sequence it is set to the newest past marker of its parents, that is the one that has the largest <code>MI</code>. The past marker of a marker is set to itself.</li><li><strong>sequence rank:</strong> The rank of a sequence will be simply called rank throughout this code. Bear in mind that for clarity the marker rank is called index.</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="design">Design<a class="hash-link" href="#design" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="the-markers">The Markers<a class="hash-link" href="#the-markers" title="Direct link to heading">‚Äã</a></h3><p>Markers are messages selected from the tip set periodically and assigned unique identifiers, in the form of $<!-- -->[SID, MI]<!-- -->$. </p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="marker-structure">Marker structure<a class="hash-link" href="#marker-structure" title="Direct link to heading">‚Äã</a></h4><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>SequenceID</td><td>uint64</td><td>The Sequence identifier of the marker.</td></tr><tr><td>Index</td><td>uint64</td><td>The index of the marker in the sequence.</td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="create-markers">Create markers<a class="hash-link" href="#create-markers" title="Direct link to heading">‚Äã</a></h4><p>A new marker is created when:</p><ol><li>the default conditions are met, which will be one of these options:<ul><li><strong>every x messsages</strong>;</li></ul><ul><li><strong>every t seconds</strong>;</li><li>a mix of the first two!<ul><li>Upperbound given by the messages</li><li>Lower temporal bound given by the time</li></ul></li><li>every x messages that reference (directly or indirectly) the previous marker<ul><li>Lower bound given by rank (e.g., how far you are in terms of steps) -&gt; &gt;= 10 or something</li><li>Upper bound given by the amount of messages referencing the previous one -&gt; ~ 200 msgs</li></ul></li></ul></li><li>A new sequence is created. <blockquote><p>üì£ to be confirmed here.</p></blockquote></li></ol><p>A new marker is selected from the strong tips set randomly, and selected from the weak tips set if there&#x27;s no strong tip. A new pair of $<!-- -->[SID, MI]<!-- -->$ is assigned to the new marker. </p><blockquote><p>üì£  to be confirmed here.</p></blockquote><p>The <code>SID</code> is set according to the following rules:</p><ul><li>Inherit the <code>SID</code> from parents if the new marker references the latest marker of a sequence and meets the requirement to set up a new marker without initiating a new MS.</li><li>Create a new <code>SID</code> if it is the first marker of a new sequence.</li></ul><p>The <code>MI</code> is set to $MI = 1+ max(referencedMI)$, which complies to the rule:</p><ul><li>Marker indexes (<code>MI</code>s) are monotonically increasing such that $\forall x \in fc(y)$ =&gt; $MI_x &gt; MI_y$, where $fc(y)$ is the future cone of $y$ and $x$ is any message in that future cone.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="markers-in-messages">Markers in Messages<a class="hash-link" href="#markers-in-messages" title="Direct link to heading">‚Äã</a></h3><p>Each message keeps its associated marker information in two lists:</p><ul><li>past markers </li><li>future markers </li></ul><p>These lists for past markers and future markers are used to determine whether a message is in the past cone of the other, and the list for future markers also helps us to efficiently estimate the approval weight of a message.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="structuredetails-structure">StructureDetails structure<a class="hash-link" href="#structuredetails-structure" title="Direct link to heading">‚Äã</a></h4><p>StructureDetails is a structure that will be in the message metadata containing marker information.</p><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>Rank</td><td>uint64</td><td>The rank of the message.</td></tr><tr><td>IsPastMarker</td><td>bool</td><td>A flag to indicate whether a message is a marker.</td></tr><tr><td>PastMarkers</td><td>map<!-- -->[SequenceID]<!-- -->Index</td><td>PM list, a list of PMs from different sequences.</td></tr><tr><td>FutureMarkers</td><td>map<!-- -->[SequenceID]<!-- -->Index</td><td>FM list, a list of FMs from different sequences.</td></tr></tbody></table><h5 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="past-markers">Past markers<a class="hash-link" href="#past-markers" title="Direct link to heading">‚Äã</a></h5><ul><li>The <code>PM</code> list of a marker contains the marker itself only.</li><li>The <code>PM</code> list of non-marker messages is inherited from its <strong>strong</strong> parents, with 2 steps:<ol><li>for a given sequence select only the nearest marker (i.e. the markers with the highest <code>MI</code>). Thus for every sequence from the parents there will be exactly one marker.</li><li>remove those that have been referenced by other markers from this set. </li></ol></li></ul><h5 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="future-markers">Future markers<a class="hash-link" href="#future-markers" title="Direct link to heading">‚Äã</a></h5><p>The <code>FM</code> list of a message is empty at start and gets updated when a new marker directly or indirectly references it. The propagation of a <code>FM</code> to its past cone (i.e. the update of the <code>FutureMarkers</code> field in the encountered messages) does not continue beyond a message if:</p><ol><li>the <code>FM</code> list of a message includes a previous marker of the same sequence;</li><li>the message is the marker in the different sequence, we update the <code>FM</code> list of that marker only.</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="the-sequence">The Sequence<a class="hash-link" href="#the-sequence" title="Direct link to heading">‚Äã</a></h3><p>Sequences are used to track the UTXO DAG branches, each branch corresponds to a sequence with a unique <code>SID</code>, and the sequences form a DAG as well.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="sequence-structure">Sequence structure<a class="hash-link" href="#sequence-structure" title="Direct link to heading">‚Äã</a></h4><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>id</td><td>uint64</td><td>The sequence identifier of the sequence.</td></tr><tr><td>parentReferences</td><td>map<!-- -->[uint64]<!-- -->Thresholdmap</td><td>The marker referenced map of each parent marker.</td></tr><tr><td>rank</td><td>uint64</td><td>The rank of the sequence in the marker DAG.</td></tr><tr><td>highestIndex</td><td>uint64</td><td>The highest MI of the marker sequence.</td></tr><tr><td>lowestIndex</td><td>uint64</td><td>The lowest MI of the sequence.</td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="create-sequence">Create sequence<a class="hash-link" href="#create-sequence" title="Direct link to heading">‚Äã</a></h4><p>A new sequence is created when:</p><ol><li>there&#x27;s a conflict in a UTXO branch.</li><li>the UTXO branches are aggregated.</li><li>UTXO branches are merged.</li></ol><p>Each new sequence starts from a new marker.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="sequences">Sequences<a class="hash-link" href="#sequences" title="Direct link to heading">‚Äã</a></h4><p>For whatever reason a sequence is created, we assign a new $SID = 1+max(referenceSequencesIdentifiers)$. To prevent assigning a new <code>SID</code> when combining same sequences again, we build parents-child relation in a map if a new sequence is created. </p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="sequence-rank">Sequence rank<a class="hash-link" href="#sequence-rank" title="Direct link to heading">‚Äã</a></h4><p>The rank of a sequence graph is the number of sequences from the starting point to itself. The sequence ranks are shown in the figure above.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="example-1">Example 1<a class="hash-link" href="#example-1" title="Direct link to heading">‚Äã</a></h2><p>Here is an example of how the markers and sequences structures would look in the Tangle:
The purple colored messages are markers.</p><p><a target="_blank" href="/assets/files/example_1-670c675a90452a0642316170a5abe1f5.png"><img alt="How the markers and sequences structures would look in the Tangle" src="/assets/images/example_1-670c675a90452a0642316170a5abe1f5.png" title="Example 1" class="fullscreen-image__source"></a></p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="example-2-test-for-the-mapping-interaction-with-the-booker">Example 2: Test for the Mapping interaction with the Booker<a class="hash-link" href="#example-2-test-for-the-mapping-interaction-with-the-booker" title="Direct link to heading">‚Äã</a></h2><p>The Marker tool implementation is tested for correct Marker and Booker mapping. A transaction-by-transaction discussion of the test can be found <a href="https://github.com/iotaledger/goshimmer/blob/develop/packages/tangle/images/TestBookerMarkerMappings.md" target="_blank" rel="noopener noreferrer">here</a> and can be viewed by opening the file locally in a browser. Transactions arrive in the order of their transaction number. The end result and the values in the various fields is shown in the following figures:</p><p><a target="_blank" href="/assets/files/example_2_1-00d77f7d9f884c458a80645806106665.png"><img alt="Mapping interaction with the Booker" src="/assets/images/example_2_1-00d77f7d9f884c458a80645806106665.png" title="Mapping interaction with the Booker1" class="fullscreen-image__source"></a></p><p><a target="_blank" href="/assets/files/example_2_2-ce4881c2d64bda5d044b32087fb0c2eb.png"><img alt="Transactions arrive in the order of their transaction number" src="/assets/images/example_2_2-ce4881c2d64bda5d044b32087fb0c2eb.png" title="Transactions arrive in the order of their transaction number" class="fullscreen-image__source"></a></p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="implementation-details">Implementation Details<a class="hash-link" href="#implementation-details" title="Direct link to heading">‚Äã</a></h2><p>In the following we describe some of the functions in more detail.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="normalization-of-the-referenced-pms-and-sequences">Normalization of the Referenced PMs and Sequences<a class="hash-link" href="#normalization-of-the-referenced-pms-and-sequences" title="Direct link to heading">‚Äã</a></h3><p>Messages can have markers from different sequences in <code>PM</code> list and <code>FM</code> list, the order and referenced relationship among sequences are important for example when it comes to inheriting the <code>PM</code> list from parents. Thus, we need to track these sequences.</p><p>When a new sequence is created we check the parent marker&#x27; sequences with the function <code>normalizeMarkers()</code> in order from high to low rank. In this function, we remove those <code>PM</code>s that it&#x27;s belonging sequence is referenced by others.</p><p>An example is <strong>msg 10</strong> in the figure above, $<!-- -->[0,2]<!-- -->, <!-- -->[1,1]<!-- -->, <!-- -->[2,3]<!-- -->$ are <code>PM</code>s to be considered to inherit. $<!-- -->[2,3]<!-- -->$ is the first marker to check, since it has the highest sequence rank. We select the parent sequences of $<!-- -->[2,3]<!-- -->$, which are $0$ and $1$, and the referenced <code>PM</code>s therein. Next any <code>PM</code>s that are already referenced can be removed. This results in that the PMs of <strong>msg 10</strong> is $<!-- -->[2,3]<!-- -->$ only.</p><p>In the following we show the implementation of  <code>normalizeMarkers()</code>, which returns the markers and sequences that will be inherited from a message.</p><div class="codeBlockContainer_K1bP language-go theme-code-block"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// normalizeMarkers takes a set of Markers and removes each Marker that is already referenced by another Marker in the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// same set (the remaining Markers are the &quot;most special&quot; Markers that reference all Markers in the set grouped by the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// rank of their corresponding Sequence). In addition, the method returns all SequenceIDs of the Markers that were not</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// referenced by any of the Markers (the tips of the Sequence DAG).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Manager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">normalizeMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">markers </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Markers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">normalizedMarkersByRank </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">markersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> normalizedSequences SequenceIDs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rankOfSequencesCache </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">make</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">SequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token builtin" style="color:rgb(130, 170, 255)">uint64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    normalizedMarkersByRank </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">newMarkersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    normalizedSequences </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">make</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SequenceIDs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// group markers with same sequence rank</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    markers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ForEach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sequenceID SequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> index Index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        normalizedSequences</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">sequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> types</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Void</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        normalizedMarkersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">rankOfSequence</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rankOfSequencesCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    markersToIterate </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> normalizedMarkersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Clone</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//iterate from highest sequence rank to lowest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> markersToIterate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">HighestRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> normalizedMarkersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">LowestRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">--</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        currentRank </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        markersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rankExists </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> markersToIterate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Markers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currentRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">rankExists </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// for each marker from the current sequence rank check if we can remove a marker in normalizedMarkersByRank,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// and add the parent markers to markersToIterate if necessary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">markersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ForEach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sequenceID SequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> index Index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> currentRank </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> normalizedMarkersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">LowestRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">CachedSequence</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">CachedObject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sequenceStore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Bytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Consume</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sequence </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Sequence</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// for each of the parentMarkers of this particular index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                sequence</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">HighestReferencedParentMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ForEach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">referencedSequenceID SequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> referencedIndex Index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// of this marker delete the referenced sequences since they are no sequence tips anymore in the sequence DAG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token function" style="color:rgb(130, 170, 255)">delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">normalizedSequences</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> referencedSequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    rankOfReferencedSequence </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">rankOfSequence</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">referencedSequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rankOfSequencesCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// check whether there is a marker in normalizedMarkersByRank that is from the same sequence</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> indexExists </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> normalizedMarkersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rankOfReferencedSequence</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> referencedSequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> indexExists </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> referencedIndex </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> index </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// this referencedParentMarker is from the same sequence as a marker in the list but with higher index - hence remove the index from the Marker list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            normalizedMarkersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rankOfReferencedSequence</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> referencedSequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// if rankOfReferencedSequence is already the lowest rank of the original markers list,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// no need to add it since parents of the referencedMarker cannot delete any further elements from the list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> rankOfReferencedSequence </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> normalizedMarkersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">LowestRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                markersToIterate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rankOfReferencedSequence</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> referencedSequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> referencedIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// if rankOfReferencedSequence is already the lowest rank of the original markers list,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// no need to add it since parents of the referencedMarker cannot delete any further elements from the list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> rankOfReferencedSequence </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> normalizedMarkersByRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">LowestRank</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        markersToIterate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rankOfReferencedSequence</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> referencedSequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> referencedIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token function" style="color:rgb(130, 170, 255)">panic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fmt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Sprintf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;failed to load Sequence with %s&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="markers-application-past-cone-check">Markers Application: Past Cone Check<a class="hash-link" href="#markers-application-past-cone-check" title="Direct link to heading">‚Äã</a></h3><p>By comparing the past and future markers of messages, we can easily tell if one is in another&#x27;s past cone. The function returns a <code>TriBool</code> representing the three possible statuses: <code>True</code>, <code>False</code> and <code>Maybe</code>. If <code>Maybe</code> is returned, then we need to perform a search of the Tangle by walking by means of e.g. a Breadth-First Search.</p><p>In the following we show the implementation of the past cone check: </p><div class="codeBlockContainer_K1bP language-go theme-code-block"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// IsInPastCone checks if the earlier Markers are directly or indirectly referenced by the later Markers.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">Manager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">IsInPastCone</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">earlierMarkers </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">MarkersPair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> laterMarkers </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">MarkersPair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">referenced TriBool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// fast check: if earlier Markers have larger highest Indexes they can&#x27;t be in the past cone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">HighestIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">HighestIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// fast check: if earlier Marker is a past Marker and the later ones reference it we can return early</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">IsPastMarker </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        earlierMarker </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">FirstMarker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> earlierMarker </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">panic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;failed to retrieve Marker&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> laterIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sequenceExists </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">earlierMarker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> sequenceExists </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> laterIndex </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> earlierMarker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">index </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">HighestIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> earlierMarker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">index </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">IsPastMarker </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        laterMarker </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">FirstMarker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> laterMarker </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">panic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;failed to retrieve Marker&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// if the earlier Marker inherited an Index of the same Sequence that is higher than the later we return false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> earlierIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sequenceExists </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">laterMarker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> sequenceExists </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> earlierIndex </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> laterMarker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">index </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// if the earlier Markers are referenced by a Marker of the same Sequence that is larger, we are not in the past cone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> earlierFutureIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> earlierFutureIndexExists </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FutureMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">laterMarker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> earlierFutureIndexExists </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> earlierFutureIndex </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> laterMarker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">index </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// if the earlier Markers were referenced by the same or a higher future Marker we are not in the past cone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// (otherwise we would be the future marker)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FutureMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ForEach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sequenceID SequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> laterIndex Index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            earlierIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> similarSequenceExists </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FutureMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">similarSequenceExists </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> earlierIndex </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> laterIndex</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">HighestIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> laterMarker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">index </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// if the highest Indexes of both past Markers are the same ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">HighestIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">HighestIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ... then the later Markers should contain exact copies of all of the highest earlier Markers because parent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Markers get inherited and if they would have been captured by a new Marker in between then the highest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Indexes would no longer be the same</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ForEach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sequenceID SequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> earlierIndex Index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> earlierIndex </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">HighestIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                laterIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sequenceExists </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> sequenceExists </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> laterIndex </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> earlierIndex</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FutureMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">HighestIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FutureMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">HighestIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// the earlier future markers need to contain all later ones because if there would be another marker in between that shadows them the later future Marker would have a higher index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FutureMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ForEach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sequenceID SequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> laterIndex Index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> laterIndex </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FutureMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">highestIndex </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                earlierIndex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sequenceExists </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FutureMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sequenceID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> sequenceExists </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> earlierIndex </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> laterIndex</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// detailed check: earlier marker is referenced by something that the later one references</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">markersReferenceMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FutureMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// detailed check: the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">markersReferenceMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">earlierMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">FutureMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> laterMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">PastMarkers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> Maybe</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="markers-application-approval-weight-estimation">Markers Application: Approval Weight Estimation<a class="hash-link" href="#markers-application-approval-weight-estimation" title="Direct link to heading">‚Äã</a></h3><p>To approximate the approval weight of a message, we simply retrieve the approval weight of its <code>FM</code> list. Since the message is in the past cone of its <code>FM</code>s, the approval weight and the finality will be at least the same as its <code>FM</code>s. This will of course be a lower bound (which is the ‚Äúsafe‚Äù bound), but if the markers are set frequently enough, it should be a good approximation.</p><p>For details of managing approval weight of each marker and approval weight calculation thereof please refer to <a href="/goshimmer/protocol_specification/components/consensus_mechanism#approval-weight-aw">Approval Weight</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/iotaledger/goshimmer/edit/develop/documentation/docs/protocol_specification/components/markers.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/goshimmer/protocol_specification/components/advanced_outputs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">UTXO Output Types</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/goshimmer/protocol_specification/glossary"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Glossary</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#dependency" class="table-of-contents__link toc-highlight">Dependency</a></li><li><a href="#definitions" class="table-of-contents__link toc-highlight">Definitions</a></li><li><a href="#design" class="table-of-contents__link toc-highlight">Design</a><ul><li><a href="#the-markers" class="table-of-contents__link toc-highlight">The Markers</a></li><li><a href="#markers-in-messages" class="table-of-contents__link toc-highlight">Markers in Messages</a></li><li><a href="#the-sequence" class="table-of-contents__link toc-highlight">The Sequence</a></li></ul></li><li><a href="#example-1" class="table-of-contents__link toc-highlight">Example 1</a></li><li><a href="#example-2-test-for-the-mapping-interaction-with-the-booker" class="table-of-contents__link toc-highlight">Example 2: Test for the Mapping interaction with the Booker</a></li><li><a href="#implementation-details" class="table-of-contents__link toc-highlight">Implementation Details</a><ul><li><a href="#normalization-of-the-referenced-pms-and-sequences" class="table-of-contents__link toc-highlight">Normalization of the Referenced PMs and Sequences</a></li><li><a href="#markers-application-past-cone-check" class="table-of-contents__link toc-highlight">Markers Application: Past Cone Check</a></li><li><a href="#markers-application-approval-weight-estimation" class="table-of-contents__link toc-highlight">Markers Application: Approval Weight Estimation</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer padding--none"><div class="container"><div class="row footer__links padding-vert--xl"><div class="col footer__col"><h4 class="footer__title">LEARN</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/learn/about-iota/an-introduction-to-iota">About IOTA</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/iota-token/buying-iota">IOTA Token</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/wallets/what-is-a-wallet">Wallets</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/networks/iota-1.5-chrysalis">Networks</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/glossary">Glossary</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/research/research-outline">Research</a></li><li class="footer__item"><a class="footer__link-item" href="/learn/future/future-of-iota">Future of IOTA</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">PARTICIPATE</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/participate/support-the-network/about-nodes">Support the network</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/the-community/discord">The Community</a></li><li class="footer__item"><a href="https://www.iota.org/solutions/partnerships" target="_blank" rel="noopener noreferrer" class="footer__link-item">Partnerships</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/funding/edf-funding">Funding</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/use-cases/industry-applications">Use Cases</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/frameworks/introduction">Frameworks</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">BUILD</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/build/welcome">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/build/fundamentals/cryptography">Fundamentals</a></li><li class="footer__item"><a class="footer__link-item" href="/build/exchange-integration/exchange-integration-guide">Exchange Integration</a></li><li class="footer__item"><a class="footer__link-item" href="/build/tutorials/twitch">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">WIKI</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/team">Team</a></li><li class="footer__item"><a href="https://github.com/iota-community/iota-wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://github.com/jlvandenhout/docusaurus-plugin-docs-editor" target="_blank" rel="noopener noreferrer" class="footer__link-item">Editor Github</a></li><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/participate/contribute-to-wiki/welcome">Contribute</a></li></ul></div></div><div class="footer__bottom padding-bottom--xl"><div><a href="https://www.iota.org" target="_blank" rel="noopener noreferrer"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">¬© 2022 IOTA Wiki. Built with Docusaurus.</div></div></div><div class="social"><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:var(--ifm-color-gray-900)" href="https://www.youtube.com/c/iotafoundation"><div class="social__font social__icon">Ó§á</div><div class="social__title">Youtube</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#2C3850" href="https://www.github.com/iotaledger/"><div class="social__font social__icon">Ó§Ç</div><div class="social__title">GitHub</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#4B576F" href="https://discord.iota.org/"><div class="social__font social__icon">Ó§Ä</div><div class="social__title">Discord</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#6A768E" href="https://www.twitter.com/iota/"><div class="social__font social__icon">Ó§Ü</div><div class="social__title">Twitter</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#7D89A1" href="https://www.reddit.com/r/iota/"><div class="social__font social__icon">Ó§Ö</div><div class="social__title">Reddit</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#8995AD" href="https://www.linkedin.com/company/iotafoundation/"><div class="social__font social__icon">Ó§Ñ</div><div class="social__title">LinkedIn</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#99A5BD" href="https://www.instagram.com/iotafoundation/"><div class="social__font social__icon">Ó§É</div><div class="social__title">Instagram</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#BAC6DE" href="https://www.facebook.com/TheIOTAFoundation/"><div class="social__font social__icon">Ó§Å</div><div class="social__title">Facebook</div></a></div></footer></div>
<script src="/assets/js/runtime~main.6a9f2868.js"></script>
<script src="/assets/js/main.1ac64b7d.js"></script>
</body>
</html>