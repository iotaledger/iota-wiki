"use strict";(self.webpackChunkiota_wiki=self.webpackChunkiota_wiki||[]).push([[5378],{35690:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return c},default:function(){return d}});var o=n(22122),r=n(19756),a=(n(67294),n(3905)),l=["components"],i={},s="Docker private network",p={unversionedId:"tooling/docker_private_network",id:"tooling/docker_private_network",isDocsHomePage:!1,title:"Docker private network",description:"We provide a tool at tools/docker-network with which a local test network can be set up locally with docker.",source:"@site/external/goshimmer/documentation/docs/tooling/docker_private_network.md",sourceDirName:"tooling",slug:"/tooling/docker_private_network",permalink:"/goshimmer/tooling/docker_private_network",version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Tooling",permalink:"/goshimmer/tooling"},next:{title:"Integration tests with Docker",permalink:"/goshimmer/tooling/integration_tests"}},c=[{value:"How to use the tool",id:"how-to-use-the-tool",children:[]},{value:"How to use as development tool",id:"how-to-use-as-development-tool",children:[]},{value:"Snapshot tool",id:"snapshot-tool",children:[]},{value:"How to use message approval check tool",id:"how-to-use-message-approval-check-tool",children:[]},{value:"Spammer tool",id:"spammer-tool",children:[]},{value:"Tangle width",id:"tangle-width",children:[]}],m={toc:c};function d(e){var t=e.components,i=(0,r.Z)(e,l);return(0,a.kt)("wrapper",(0,o.Z)({},m,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"docker-private-network"},"Docker private network"),(0,a.kt)("p",null,"We provide a tool at ",(0,a.kt)("inlineCode",{parentName:"p"},"tools/docker-network")," with which a local test network can be set up locally with docker. "),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Docker network",src:n(91907).Z,title:"Docker network"})),(0,a.kt)("h2",{id:"how-to-use-the-tool"},"How to use the tool"),(0,a.kt)("p",null,"In the docker network run for example"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"./run.sh 5 1 1\n")),(0,a.kt)("p",null,"The command ",(0,a.kt)("inlineCode",{parentName:"p"},"./run.sh")," spins up a GoShimmer network within Docker as schematically shown in the figure above. The first integer input defines the number of ",(0,a.kt)("inlineCode",{parentName:"p"},"peer_replicas")," ",(0,a.kt)("inlineCode",{parentName:"p"},"N"),". The second argument is optional for activating the Grafana dashboard, where "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"default (no argument) or 0: Grafana disabled"),(0,a.kt)("li",{parentName:"ul"},"1: Grafana enabled")),(0,a.kt)("p",null,"More details on how to set up the dashboard can be found ",(0,a.kt)("a",{parentName:"p",href:"/goshimmer/tutorials/setup"},"here"),"."),(0,a.kt)("p",null,"The third argument is optional for activating a dRNG committee, where"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"default (no argument) or 0: dRNG disabled"),(0,a.kt)("li",{parentName:"ul"},"1: dRNG enabled")),(0,a.kt)("p",null,"The peers can communicate freely within the Docker network\nwhile the analysis and visualizer dashboard, as well as the ",(0,a.kt)("inlineCode",{parentName:"p"},"master_peer's")," dashboard and web API are reachable from the host system on the respective ports."),(0,a.kt)("p",null,"The settings for the different containers (",(0,a.kt)("inlineCode",{parentName:"p"},"entry_node"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"peer_master"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"peer_replica"),") can be modified in ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose.yml"),"."),(0,a.kt)("h2",{id:"how-to-use-as-development-tool"},"How to use as development tool"),(0,a.kt)("p",null,"Using a standalone throwaway Docker network can be really helpful as a development tool. "),(0,a.kt)("p",null,"Prerequisites: "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Docker 17.12.0+"),(0,a.kt)("li",{parentName:"ul"},"Docker compose: file format 3.5")),(0,a.kt)("p",null,"Reachable from the host system"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"analysis dashboard (autopeering visualizer): http://localhost:9000"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"master_peer's")," dashboard: http: http://localhost:8081"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"master_peer's")," web API: http: http://localhost:8080")),(0,a.kt)("p",null,"It is therefore possible to send messages to the local network via the ",(0,a.kt)("inlineCode",{parentName:"p"},"master_peer"),". Log messages of a specific containter can be followed via "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"docker logs --follow CONTAINERNAME\n")),(0,a.kt)("h2",{id:"snapshot-tool"},"Snapshot tool"),(0,a.kt)("p",null,"A snapshot tool is provided in the tools folder. The snapshot file that is created must be moved into the ",(0,a.kt)("inlineCode",{parentName:"p"},"integration-tests/assets")," folder. There, rename and replace the existing bin file (",(0,a.kt)("inlineCode",{parentName:"p"},"7R1itJx5hVuo9w9hjg5cwKFmek4HMSoBDgJZN8hKGxih.bin"),"). After restarting the docker network the snapshot file will be loaded."),(0,a.kt)("h2",{id:"how-to-use-message-approval-check-tool"},"How to use message approval check tool"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"get_approval_csv.sh")," script helps you conveniently trigger the message approval checks on all nodes in the docker\nnetwork, and gather their results in the ",(0,a.kt)("inlineCode",{parentName:"p"},"csv")," folder."),(0,a.kt)("p",null,"Once the network is up and running, execute the script:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"./get_approval_csv.sh\n")),(0,a.kt)("p",null,"Example output:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Triggering approval analysis on peer_master and 20 replicas...\nTriggering approval analysis on peer_master and 20 replicas... DONE\nCopying csv files from peer_master and 20 replicas...\nCopying csv files from peer_master and 20 replicas... DONE\nCopied files are located at ./csv\n")),(0,a.kt)("p",null,"The exported csv files are timestamped to the date of request."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"csv\n\u251c\u2500\u2500 210120_16_34_14-docker-network_peer_replica_10.csv\n\u251c\u2500\u2500 210120_16_34_14-docker-network_peer_replica_11.csv\n\u251c\u2500\u2500 210120_16_34_14-docker-network_peer_replica_12.csv\n...\n")),(0,a.kt)("p",null,"Note, that the record length of the files might differ, since the approval check execution time of the nodes might differ."),(0,a.kt)("h2",{id:"spammer-tool"},"Spammer tool"),(0,a.kt)("p",null,"The Spammer tool lets you add messages to the tangle when running GoShimmer in a Docker network.\nIn order to start the spammer, you need to send GET requests to a ",(0,a.kt)("inlineCode",{parentName:"p"},"/spammer")," API endpoint with the following parameters:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cmd")," - one of two possible values: ",(0,a.kt)("inlineCode",{parentName:"li"},"start")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"stop"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"mpm")," - messages per minute. Only applicable when ",(0,a.kt)("inlineCode",{parentName:"li"},"cmd=start"),". "),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"imif")," - (",(0,a.kt)("em",{parentName:"li"},"optional"),") parameter indicating time interval between issued messages. Possible values:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"poisson")," - emit messages modeled with Poisson point process, whose time intervals are exponential variables with mean 1/rate"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"uniform")," - issues messages at constant rate")))),(0,a.kt)("p",null,"Example requests:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"http://localhost:8080/spammer?cmd=start&mpm=1000\n\nhttp://localhost:8080/spammer?cmd=start&mpm=1000&imif=uniform\nhttp://localhost:8080/spammer?cmd=stop\n")),(0,a.kt)("h2",{id:"tangle-width"},"Tangle width"),(0,a.kt)("p",null,"When running GoShimmer locally in a Docker network, the network delay is so small that only 1 tip will be available most of the time.\nIn order to artificially create a tangle structure with multiple tips you can add a ",(0,a.kt)("inlineCode",{parentName:"p"},"messageLayer.tangleWidth")," property to ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/iotaledger/goshimmer/blob/develop/tools/docker-network/config.docker.json"},"config.docker.json"),"\nthat specifies the number of tips that nodes should retain. This setting exists only for local testing purposes and should not be used in a distributed testnet.  "),(0,a.kt)("p",null,"Here is an example config that can be added: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'  {\n  "messageLayer": {\n    "tangleWidth": 10\n  }}\n')))}d.isMDXComponent=!0},3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return u}});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(n),u=r,h=d["".concat(s,".").concat(u)]||d[u]||m[u]||a;return n?o.createElement(h,l(l({ref:t},c),{},{components:n})):o.createElement(h,l({ref:t},c))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var p=2;p<a;p++)l[p]=n[p];return o.createElement.apply(null,l)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},91907:function(e,t,n){t.Z=n.p+"assets/images/docker-network-a90acb2c45455d331cf18884cb319919.png"}}]);