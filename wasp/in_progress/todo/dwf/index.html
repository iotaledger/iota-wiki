<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="IOTA Wiki Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="IOTA Wiki Blog Atom Feed">
<link rel="preconnect" href="${matomoUrl}">
<script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://matomo.antonionardella.it/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","6"]);var e=document,t=e.createElement("script"),p=e.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=a+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>
<link rel="search" type="application/opensearchdescription+xml" title="IOTA Wiki" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">dwf | IOTA Wiki</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wiki.iota.org/wasp/in_progress/todo/dwf"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-wasp-current"><meta data-react-helmet="true" property="og:title" content="dwf | IOTA Wiki"><meta data-react-helmet="true" name="description" content="Obsolete. To be adjusted to the new version"><meta data-react-helmet="true" property="og:description" content="Obsolete. To be adjusted to the new version"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wiki.iota.org/wasp/in_progress/todo/dwf"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/wasp/in_progress/todo/dwf" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wiki.iota.org/wasp/in_progress/todo/dwf" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b37da063.css">
<link rel="preload" href="/assets/js/runtime~main.3ec71eb6.js" as="script">
<link rel="preload" href="/assets/js/main.1fc3041e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#ff0000;color:#fff" role="banner"><div class="announcementBarContent_3EUC">The work on this Wiki is still in progress. Consider contributing by using the in page editor or creating a <a href="https://github.com/iota-community/iota-wiki">PR directly</a></div></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo_dark.svg" alt="IOTA Wiki Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link" href="/docs/learn/about-iota/an-introduction-to-iota"><div class="link"><div class="link__body"><div class="link__label">Learn</div></div></div></a><a class="navbar__item navbar__link" href="/docs/participate/support-the-network/about-nodes"><div class="link"><div class="link__body"><div class="link__label">Participate</div></div></div></a><div class="dropdown dropdown--hoverable dropdown--mega"><a href="#" class="navbar__item navbar__link"><div class="link"><div class="link__body"><div class="link__label">Build</div></div></div></a><div class="dropdown__container"><div class="dropdown__menu"><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Getting Started</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Chrysalis (IOTA 1.5)</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Libraries</div></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Smart Contracts</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/docs/build/getting-started/architecture"><div class="link"><div class="link__icon">Ó§Ç</div><div class="link__body"><div class="link__label">Getting Started</div><div class="link__sublabel">IOTA development basics</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/chrysalis-docs/welcome"><div class="link"><div class="link__icon">Ó§Å</div><div class="link__body"><div class="link__label">Chrysalis Docs</div><div class="link__sublabel">Mainnet documentation</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/iota.rs/welcome"><div class="link"><div class="link__icon">Ó§á</div><div class="link__body"><div class="link__label">Core</div><div class="link__sublabel">IOTA core functionality</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a aria-current="page" class="dropdown__link dropdown__link--active" href="/wasp/welcome"><div class="link"><div class="link__icon">Ó§ã</div><div class="link__body"><div class="link__label">Wasp Node</div><div class="link__sublabel">Smart contract node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/bee/getting_started/getting_started"><div class="link"><div class="link__icon">Ó§Ä</div><div class="link__body"><div class="link__label">Bee Node</div><div class="link__sublabel">IOTA node written in Rust</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/wallet.rs/welcome"><div class="link"><div class="link__icon">Ó§ä</div><div class="link__body"><div class="link__label">Wallet</div><div class="link__sublabel">Build IOTA wallets</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><div class="dropdown__label">Coordicide (IOTA 2.0)</div></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/hornet/welcome"><div class="link"><div class="link__icon">Ó§Ñ</div><div class="link__body"><div class="link__label">Hornet Node</div><div class="link__sublabel">IOTA node written in Go</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/stronghold.rs/welcome"><div class="link"><div class="link__icon">Ó§â</div><div class="link__body"><div class="link__label">Stronghold</div><div class="link__sublabel">Handle secrets securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/IOTA-2.0-Research-Specifications/Preface"><div class="link"><div class="link__icon">Ó§Ü</div><div class="link__body"><div class="link__label">Coordicide Specs</div><div class="link__sublabel">Decentralizing IOTA</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/identity.rs/introduction"><div class="link"><div class="link__icon">Ó§Ö</div><div class="link__body"><div class="link__label">Identity</div><div class="link__sublabel">Identity framework</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/goshimmer/welcome"><div class="link"><div class="link__icon">Ó§É</div><div class="link__body"><div class="link__label">GoShimmer Node</div><div class="link__sublabel">IOTA 2.0 node</div></div></div></a></div></div><div class="row row--no-gutters dropdown__row"><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"></div><div class="col margin-horiz--xs dropdown__col"><a class="dropdown__link" href="/streams/welcome"><div class="link"><div class="link__icon">Ó§à</div><div class="link__body"><div class="link__label">Streams</div><div class="link__sublabel">Share data securely</div></div></div></a></div><div class="col margin-horiz--xs dropdown__col"></div></div></div></div></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog"><div class="link"><div class="link__body"><div class="link__label">Blog</div></div></div></a><a class="navbar__item navbar__link" href="/team"><div class="link"><div class="link__body"><div class="link__label">Team</div></div></div></a><div class="toggle toggle_3Zt9 toggle--checked toggle--disabled" role="button" tabindex="-1"><div class="toggle__icon toggle__icon--unchecked" style="font-family:Material Icons">dark_mode</div><div class="toggle__icon toggle__icon--checked" style="font-family:Material Icons">light_mode</div><input type="checkbox" checked="" class="toggle__screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_2HBr"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>dwf</h1></header><p><em>Obsolete. To be adjusted to the new version</em></p><hr><header><h1>Main concepts with <em>DonateWithFeedback</em></h1></header><p>We will explain main concepts of IOTA smart contracts using deployed PoC smart contract called <em>DonateWithFeedback</em>.
We wrote this article as a part of the <em>PoC release of the Wasp</em>.
The <a href="http://waspdev01.iota.cafe:10000" target="_blank" rel="noopener noreferrer">demo dashboard</a>
of the instance of the <em>DonateWithFeedback</em> SC and <em>wwallet</em>,
a smart contract wallet, can be used as a visual aid for the text below. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p><em>DonateWithFeedback</em> is the simplest of all 3 hard coded smart contracts, included into the PoC release of the Wasp.
You may see it as a ‚ÄúHello, world‚Äù example. We will go along all main concepts of the IOTA Smart Contracts using
it as an example.</p><p><em>DonateWithFeedback</em> is a dApp which performs a very common function: it handles an IOTA donation
address and user‚Äôs feedback log for the owner of a web page.  </p><p><em>(You may want to follow the Go <a href="https://github.com/iotaledger/wasp" target="_blank" rel="noopener noreferrer">code of this smart contract TODO</a>
which currently is embedded right into the Wasp. This approach is not typical for the smart contracts
in general, however it is very convenient for testing the protocol.
In the future all smart contract programs will be run on wasm VM)</em>   </p><p>The common practice is to display the donation address on a web page for anyone wanting to send us a donation,
for example with their Trinity wallet.
What if we also want each donor to attach some feedback/comment text to the donation? For example,
‚ÄúHere I send you 2 MIOTA because I like your site‚Äù?
To support that possibility, we would need some kind of application, or an extension of the existing IOTA wallet
with a database for comment messages behind and so on (of course, there is more than one way to do that, including
embedding the text right into the transaction).</p><p><em>DonateWithFeedback</em> smart contract takes responsibility to handle both the donation
account (the address) and the log of feedback messages. The log of feedback messages will be kept in the
immutable storage of the smart contract‚Äôs ledger (the state).
Some may say it is an overkill, and yes, it may be a bit artificial, but why not?
Once the smart contract is fee-less anyway? Do not try this with Ethereum üòè.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="the-state"></a>The state<a class="hash-link" href="#the-state" title="Direct link to heading">#</a></h2><p>Let‚Äôs open a <a href="http://waspdev01.iota.cafe:10000/dwf" target="_blank" rel="noopener noreferrer">dashboard</a> of the demo instance of <em>DonateWithFeedback</em>.
The dashboard displays the <em>state of the smart contract</em> instance, i.e. what is contained in its tamper proof storage. </p><p>The following are the main properties of any smart contract. </p><ul><li>smart contract address (<em>SC address</em>)</li><li>Program hash</li><li>smart contract color (<em>Color</em>)</li><li>description</li></ul><p>It is displayed in the section <em>Smart contract details</em> of the demo dashboard.
These values of the state normally do not change throughout the life of the smart contract.</p><p>The state of any smart contract consists of two parts:</p><ul><li>the <em>Balance</em> part displays balances of digital assets contained in the smart contract account address.
It is an <strong>on-tangle</strong> part of the state.</li><li>The collection of <em>key-value pairs</em> which can be interpreted as variables and their values.
It is an <strong>off-tangle</strong> part of the state. In general, it can contain any data of arbitrary size.
In the <em>DonateWithFeedback</em> smart contract the dashboard displays the generic data of the state in
an SC-specific and user-friendly format:
the statistics of donations and list of feedback messages stored in the log. </li></ul><p>(note that we use <a href="https://en.bitcoinwiki.org/wiki/Base58" target="_blank" rel="noopener noreferrer">Base58 encoding</a> for binary data of fixed size, like
transaction hashes and addresses displayed on the dashboard). </p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="the-address-and-program-of-smart-contract"></a>The address and program of smart contract<a class="hash-link" href="#the-address-and-program-of-smart-contract" title="Direct link to heading">#</a></h2><p>Naturally, we can have many instances of the <em>DonateWithFeedback</em> smart contract. Each instance will correspond to
a specific donation address and its owner. The demo dashboard is displaying the state of one particular instance. </p><p>Two things define instance of any smart contract:</p><ul><li><em>Program code</em>, represented by the 32-byte long <em>program hash</em></li><li><em>Smart contract address</em>, an address on the Tangle</li></ul><p>The <em>program hash</em> is a globally unique identifier of the program.
The program itself encodes algorithms of the smart contract in some language. In IOTA smart contracts we will use
WebAssembly (a.k.a. <em>Wasm</em>) as the binary format of the smart contract program.
The hash of Wasm binary ensures the program code cannot be modified without changing the hash.</p><p>For the hard coded PoC smart contract such as <em>DonateWithFeedback</em>, the program hash is just
an ID statically embedded into the Wasp code.
For the builtin program of <em>DonateWithFeedback</em> program hash is equal to <code>5ydEfDeAJZX6dh6Fy7tMoHcDeh42gENeqVDASGWuD64X</code>.
For a WebAssembly smart contract code it will be the hash of its binary code. </p><p>The <em>smart contract address</em> is a 33-byte long address as it is implemented in Goshimmer,
for example <code>pxsUocho2dJQ8EX5PxHUHY7e4qfVmcu7K4dGRrrFrwaG</code>.</p><p>The SC address is a global unique identifier of the smart contract instance:
the smart contract can always be located on the Tangle by its address.
The address scheme we use in ISCP is a BLS address, a kind of multi-signature address.
Tokens, contained in the address, can be moved only with the corresponding private keys. </p><p>The smart contract program always ‚Äúhides‚Äù behind the smart contract address, which
is otherwise just a normal address. The <em>DonateWithFeedback</em> program is attached to each instance of
<em>DonateWithFeedback</em> program. </p><p>Unlike ordinary addresses on the Tangle, we can send <em>requests</em> to the SC address, not just tokens.
The attached program processes requests sent to it and updates the state of
the smart contract. The state can be updated only if the processor which runs the program
has access to the corresponding private keys.</p><p>Whenever we <a href="/wasp/in_progress/todo/deploy">deploy</a> a smart contract instance on the Tangle you have to specify its program hash, among other things.
Wasp node will find the program code by the hash and will link the program with the instance. </p><p>Just like the usual <code>Ed25519</code> address is generated from its private key,
the smart contract address is generated during the deployment process of the smart contract. </p><p>In <em>DonateWithFeedback</em> we use the smart contract address as a donation address to display on the web page.
We use this address to send donations. This is just an address on the Tangle,
so you can send iotas and other tokens to it using ordinary wallet. </p><p>However, this is not what we want to achieve here. The important thing is you can send <strong>requests</strong> to the
smart contract address, value transactions with metadata attached to it:
<em>smart contract transactions</em> (<em>SC transactions</em>).
Specifically, you can send a <code>donate</code> request to the <em>DonateWithFeedback</em> smart contract which encapsulates
both donated iotas and the feedback message in a single transaction.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="balance-of-the-smart-contract-account"></a>Balance of the smart contract account<a class="hash-link" href="#balance-of-the-smart-contract-account" title="Direct link to heading">#</a></h2><p>SC transactions are value transactions, i.e. they move tokens from addresses to addresses.
It is because ISCP is a protocol on top of the Goshimmer&#x27;s UTXO Ledger.
Here you can find a <a href="/wasp/misc/utxo">short introduction</a> to main concepts of it.</p><p>The smart contract account balance consists of all UTXOs contained in the smart contract address.
On the demo dashboards it is displayed in the simplified 1-dimensional form by skipping the containing transaction
IDs and summing up number of tokens for each color:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ColorCode1: balance1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ColorCode2: balance2</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The smart contract balance is an <em>on-tangle</em> part of the smart contract‚Äôs state.
It means the UTXO Ledger takes care of the consistency and immutability of the smart contract balance.</p><p>Tokens of the smart contract balances can be moved only by the smart contract instance,
which is the only entity which owns private keys.
Actually, the tokens can be moved by the smart contract program of the instance as a result of processing the request.</p><p>For example, the account balance of <em>DonateWithFeedback</em> smart contract instance contains all tokens sent
to its address. Only the smart contract can move those tokens. </p><p>If the owner of the site wants to withdraw donated iotas from the donation
address, he or she will have to <em>nicely ask</em> the smart contract to do it for them.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="requests-to-the-smart-contract"></a>Requests to the smart contract<a class="hash-link" href="#requests-to-the-smart-contract" title="Direct link to heading">#</a></h2><p>‚ÄúNicely asking‚Äù the smart contract to do something means sending a request to its instance.
A request to the smart contract always has the following structure:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Request code, Arguments --&gt; SC address</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here <code>SC address</code> is the address of the target smart contract instance.
<code>Request code</code> is analogous to a function/method name, <code>Arguments</code> are parameters.
So, sending a request to a smart contract is equivalent to a method call in the object-oriented paradigm,
except that caller doesn&#x27;t wait for the result.</p><p>Upon receiving the request, the smart contract finds the function in the smart contract program
which implements the request code and, if the function exists, it executes it.
The program function moves tokens and does all other things a smart contract program is supposed to do.</p><p>Some request codes may be marked as <em>protected requests</em>. These requests will only be processed by the smart
contract if the sender of the request is the <em>owner</em> of the smart contract (see <a href="/wasp/in_progress/todo/deploy">deployment</a>).
Protected requests sent by other than owner address will be equivalent to <em>no operation</em>
and attached funds won&#x27;t be returned. </p><p>For the user of the smart contract, however, sending a request is not complicated at all, because it is usually
is implemented as a feature the wallet.</p><p>For example, you may try the two types of requests implemented by the <em>DonateWithFeedback</em> smart contract:</p><ul><li>The <code>donate</code> request donates iotas to the address and gives a feedback message. </li><li>The <code>withdraw</code> request allows the owner to take the iotas out from the smart contract account. </li></ul><p>Let‚Äôs say address of our donation smart contract is <code>pxsUocho2dJQ8EX5PxHUHY7e4qfVmcu7K4dGRrrFrwaG</code>.
Here are full sequence of commands to <code>wasp-cli</code> to donate some iotas to our project:</p><p>Initialize your demo wallet.
It will create the <em>wwallet.json</em> file in the current directory with the private and public keys of the the address:</p><p><code>wasp-cli init</code></p><p>Request some demo iotas from the Goshimmer‚Äôs faucet: </p><p><code>wasp-cli request-funds</code></p><p>Check balance of your newly created wallet:</p><p><code>wasp-cli balance</code></p><p>It will display something like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Address: YyVP3g9B7YfvHCEzLaeD4M3iqKSawyuf8NsXxggghFhP</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Balance:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    IOTA: 1000000</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ------</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Total: 1000000</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now let the wallet know the specific address of our demo <em>DonateWithFeedback</em>
smart contract instance (<em>dwf</em> here stands for <em>DonateWithFeedback</em>, the command below associates
it with the specific address):</p><p><code>wasp-cli dwf set address pxsUocho2dJQ8EX5PxHUHY7e4qfVmcu7K4dGRrrFrwaG</code></p><p>Now we can send a <code>donate</code> request to the demo <code>DonateWithFeedback</code> smart contract instance:</p><p><code>wasp-cli dwf donate 42 ‚ÄúThis is my first donation to the IOTA Smart Contract Project</code>  </p><p>In approximately 15-20 seconds the dashboard of <em>DonateWithFeedback</em> will show you the new state
of the smart contract: with 42 iotas more in the balance and your message in the log.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="processing-the-request"></a>Processing the request<a class="hash-link" href="#processing-the-request" title="Direct link to heading">#</a></h2><p>What is going on when the we send the request like the one aboveto the smart contract address?
Let&#x27;s look at it step-by-step:</p><ol><li><p>The <code>wasp-cli</code> command creates a value transaction containing the smart contract request.
It takes 42 iotas from the address of the wallet, signs the transaction with the private key of the wallet.
Then it posts it to the UTXO Ledger, i.e to Goshimmer node, running on the Pollen network.
(there&#x27;s a bit more of a token manipulation behind scenes but we skip it here)</p></li><li><p>Pollen network confirms the transaction containing the request.
It takes some ~10 seconds. After confirmation the request it becomes part of the immutable backlog for
the smart contract instance, represented by the target SC address.</p></li><li><p>Smart contract instance picks up the request and runs the smart contract program. </p></li><li><p>The smart contract program computes a state update, which includes new outputs in the UTXO ledger and a
record in the log of feedback messages. Then the smart contract produces another transaction,
called <em>state or anchor transaction</em> which carries all the information about the new state of the SC. </p></li><li><p>The smart contract committee multi-signs the new state transaction. </p></li><li><p>The smart contract posts the state transaction to the tangle and Pollen network confirms
it in yet another ~10 seconds. This is how state transition occurs. </p></li></ol><p>So, all in all, it takes to produce and confirm 2 subsequent transactions to
update the state of the smart contract, i.e. about 20 seconds in the Pollen network. </p><p>It may not look very fast, however, each state update can contain hundreds of (batched) requests,
so even one smart contract instance is able to process many requests per second on the average.
We normally do not expect too many donations per
second (although it would be nice!), however for other use cases TPS for one smart contract may be very important.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="the-state-more-details"></a>The state: more details<a class="hash-link" href="#the-state-more-details" title="Direct link to heading">#</a></h2><p>The <em>State details</em> section of the <em>DonateWithFeedback</em> dashboard shows values, which are changing with each donation.</p><p>The current state of any smart contract has:</p><ul><li><code>state index</code>. Smart contract state is a chain of batches of state updates (think: blocks).
Each batch has an index (think: block index). The origin state has index 0, it is incremented with each new batch
of updates.</li><li><code>state hash</code> It is the result of hashing all state values since origin</li><li><code>anchor transaction</code> (or <code>state transaction</code>) which secures state on the tangle</li><li><code>batch of requests</code> (a block) which resulted in the current state from the previous. </li><li>the <code>timestamp</code> of the state. The timestamp of the state is a timestamp
<em>consistent with the local clocks</em> of all committee nodes (see below) and
all committee nodes have consensus on it. So, it is an <em>objective</em> timestamp, not just some logical value.</li></ul><p>As mentioned above, the <em>on-tangle</em> part of the state of the smart contract is the balance of its account address.
It contains tagged (colored) tokens. You can see it as the Balance in the <em>DonateWithFeedback</em> dashboard.</p><p>The state of the smart contract also contains arbitrary key/value pairs which can be interpreted as variables with values.
This part of the state is stored <em>off-tangle</em>, i.e. is not a part of transactions on the Pollen network
but instead it stored in <em>smart contract ledger</em>, the distributed database run by
the Wasp nodes for each smart contract. </p><p>The log of feedback messages in the <em>DonateWithFeedback</em> smart contract state is a collection of key/value pairs in
the database. The size of the data contained in the smart contract state is limited only by the underlying database,
i.e. is unlimited in most practical use cases. Think about Oracle with historical temperature data for months
and years in its temper-proof state. </p><p>Just like the balances are locked in the smart contract address, the whole state of the smart contract,
including the <em>off-tangle</em> part, is locked into the account address and can be updated only by the smart
contract instances with its private keys and the program.
We won‚Äôt go into details here, but the base principle is anchoring the hash of the off-tangle part of the
state in the on-tangle transaction.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h3><p>The <em>DonateWithFeedback</em> smart contract state contains the endless log of objectively time stamped donation
feedback messages, also state variables such as <em>totalDonatedSum</em> and <em>maxDonationSoFar</em>.
Each donation not only brings iotas to the smart contract account, but also it adds records to
the time stamped log of messages. The <em>time stamped log</em> is an immutable append-only data structure
in the state of the smart contract which can be queried by the time parameter, for example extracting records
between two moments of time. </p><p>In this article we went through the main concepts of IOTA smart contracts, such as <em>SC address</em>,
<em>program hash</em>, <em>SC state</em>, <em>requests</em> and <em>SC transaction</em> using a simple yet typical
smart contract <em>DonateWithFeedback</em> as an example.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#the-state" class="table-of-contents__link">The state</a></li><li><a href="#the-address-and-program-of-smart-contract" class="table-of-contents__link">The address and program of smart contract</a></li><li><a href="#balance-of-the-smart-contract-account" class="table-of-contents__link">Balance of the smart contract account</a></li><li><a href="#requests-to-the-smart-contract" class="table-of-contents__link">Requests to the smart contract</a></li><li><a href="#processing-the-request" class="table-of-contents__link">Processing the request</a></li><li><a href="#the-state-more-details" class="table-of-contents__link">The state: more details</a><ul><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer padding--none"><div class="container"><div class="row footer__links padding-vert--xl"><div class="col footer__col"><h4 class="footer__title">LEARN</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/learn/about-iota/an-introduction-to-iota">About IOTA</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/iota-token/overview">IOTA Token</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/wallets/what-is-a-wallet">Wallets</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/networks/iota-1.5-chrysalis">Networks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/resource-materials/glossary">Resource Materials</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/learn/research/research-outline">Research</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">PARTICIPATE</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/participate/support-the-network/run-a-node">Support the network</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/the-community/discord">The Community</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/partnerships/iota-partnerships">Partnerships</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/funding/edf-funding">Funding</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/use-cases/industry-applications">Use Cases</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/frameworks/introduction">Frameworks</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">BUILD</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/build/getting-started/architecture">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/build/fundamentals/cryptography">Fundamentals</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/build/exchange-integration/exchange-integration-guide">Exchange Integration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/build/tutorials/youtube">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">WIKI</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/iota-community/iota-wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://github.com/jlvandenhout/docusaurus-plugin-docs-editor" target="_blank" rel="noopener noreferrer" class="footer__link-item">Editor Github</a></li><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/participate/contribute-to-wiki/welcome">Contribute</a></li></ul></div></div><div class="footer__bottom padding-bottom--xl"><div><a href="https://www.iota.org" target="_blank" rel="noopener noreferrer"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/iota_logo.svg" alt="IOTA Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">¬© 2021 IOTA Wiki. Built with Docusaurus.</div></div></div><div class="social"><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:var(--ifm-color-gray-900)" href="https://www.youtube.com/c/iotafoundation"><div class="social__font social__icon">Ó§á</div><div class="social__title">Youtube</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#2C3850" href="https://www.github.com/iotaledger/"><div class="social__font social__icon">Ó§Ç</div><div class="social__title">GitHub</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#4B576F" href="https://discord.iota.org/"><div class="social__font social__icon">Ó§Ä</div><div class="social__title">Discord</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#6A768E" href="https://www.twitter.com/iota/"><div class="social__font social__icon">Ó§Ü</div><div class="social__title">Twitter</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#7D89A1" href="https://www.reddit.com/r/iota/"><div class="social__font social__icon">Ó§Ö</div><div class="social__title">Reddit</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#8995AD" href="https://www.linkedin.com/company/iotafoundation/"><div class="social__font social__icon">Ó§Ñ</div><div class="social__title">Linkedin</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#99A5BD" href="https://www.instagram.com/iotafoundation/"><div class="social__font social__icon">Ó§É</div><div class="social__title">Instagram</div></a><a class="social__link padding-horiz--sm padding-vert--md" style="background-color:#BAC6DE" href="https://www.facebook.com/TheIOTAFoundation/"><div class="social__font social__icon">Ó§Å</div><div class="social__title">Facebook</div></a></div></footer></div>
<script src="/assets/js/runtime~main.3ec71eb6.js"></script>
<script src="/assets/js/main.1fc3041e.js"></script>
</body>
</html>